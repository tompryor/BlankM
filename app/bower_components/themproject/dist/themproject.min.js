/*!
* Project:   The M-Project - Mobile HTML5 Application Framework
* Copyright: (c) 2014 M-Way Solutions GmbH.
* Version:   2.0.0-beta3
* Date:      Wed Jan 15 2014 11:34:12
* License:   http://github.com/mwaylabs/The-M-Project/blob/absinthe/MIT-LICENSE.txt
*/
!function(a,b,c,d){var e=null;e="undefined"!=typeof exports?exports:a.M={},e.Version=e.version="2.0.0-beta3",e.f=function(){},e.create=function(a){return new this(a)},e.design=function(a){var b=this.extend(a||{});return new b},e.extend=b.Model.extend,e.isCollection=function(a){return b.Collection.prototype.isPrototypeOf(a)},e.isModel=function(a){return b.Model.prototype.isPrototypeOf(a)},e.isEntity=function(a){return e.Entity.prototype.isPrototypeOf(a)},e.isI18NItem=function(a){return a&&a._type&&"M.I18NItem"===a._type?!0:!1},e.isController=function(a){return e.Controller.prototype.isPrototypeOf(a)},e.isView=function(a){return e.View.prototype.isPrototypeOf(a)},e.implements=function(a){return this.prototype._implementedInterfaces=a,this},YES=!0,NO=!1,e.CONST={LOGGER:{TAG_FRAMEWORK_CORE:"framework-core",TAG_FRAMEWORK_DATA:"framework-data",TAG_FRAMEWORK_UI:"framework-ui",TAG_FRAMEWORK_UTILITY:"framework-utility",TAG_ALL:""},I18N:{LOCALE_CHANGED:"locale-changed"},TYPE:{INTEGER:"integer",STRING:"string",TEXT:"text",DATE:"date",BOOLEAN:"boolean",FLOAT:"float",OBJECT:"object",ARRAY:"array",BINARY:"binary",OBJECTID:"objectid",NULL:"null"},ORDER:{ASC:"ASC",DESC:"DESC"},ERROR:{UNDEFINED:0,CONNECTION:1,VALIDATION_PRESENCE:100,VALIDATION_URL:101,VALIDATION_PHONE:102,VALIDATION_NUMBER:103,VALIDATION_NOTMINUS:104,VALIDATION_EMAIL:105,VALIDATION_DATE:106,MODEL_PROVIDER_NOT_SET:120,WEBSQL_UNKNOWN:200,WEBSQL_DATABASE:201,WEBSQL_VERSION:202,WEBSQL_TOO_LARGE:203,WEBSQL_QUOTA:204,WEBSQL_SYNTAX:205,WEBSQL_CONSTRAINT:206,WEBSQL_TIMEOUT:207,WEBSQL_NO_DBHANDLER:208,WEBSQL_NOT_SUPPORTED:209,WEBSQL_BULK_NO_RECORDS:210,COUCHDB_CONFLICT:300,COUCHDB_DBNOTFOUND:301,COUCHDB_DBEXISTS:302,COUCHDB_DOCNOTFOUND:303},INPUT:{TEXT:"text",PASSWORD:"password",NUMBER:"number",TELEPHONE:"tel",URL:"url",EMAIL:"email",TIME:"time",DATE:"date",DATETIME:"datetime",MONTH:"month",WEEK:"week"},GRID:{COLUMNS:12}},e.Object={_type:"M.Object",_implementedInterfaces:null,_create:function(a){var b=function(){};return b.prototype=a,new b},include:function(a){for(var b in a){if(this.hasOwnProperty(b))throw e.Exception.RESERVED_WORD.getException();this[b]=a[b]}return this},design:function(a){var b=this._create(this);return b.include(this._normalize(a)),b._init(),c.each(b._implementedInterfaces,function(a){b.bindToCaller(b,a._init)()},b),b},implement:function(a){if(a&&a.isMInterface){var b=a.getInterface(this);c.each(b,function(a,c){this[c]&&(b[c]=null,delete b[c])},this),this.include(b),this._implementedInterfaces=this._implementedInterfaces||[]}return this},hasInterfaceImplementation:function(a){var b=NO;return c.each(this._implementedInterfaces,function(c){a===c&&(b=YES)},this),b},bindToCaller:function(a,b,c){return function(){if("function"!=typeof b||"object"!=typeof a)throw e.Exception.INVALID_INPUT_PARAMETER.getException();return Array.isArray(c)?b.apply(a,c):b.call(a,c)}},_init:function(){},_normalize:function(a){return a=a&&"object"==typeof a?a:{}},handleCallback:function(a){var b=Array.prototype.slice.call(arguments,1);if(a){var c="object"==typeof a.target?a.target:this,d=a;if("function"==typeof a.action?d=a.action:"string"==typeof a.action&&(d=c[a.action]),"function"==typeof d)return this.bindToCaller(c,d,b)()}},getObjectType:function(){return this._type},_addInterfaces:function(){c.each(this._implementedInterfaces,function(a){this.implement(a)},this)},deepCopy:function(a){return JSON.parse(JSON.stringify(a))}},e.Config=function(a){this.options=a||{},c.isFunction(this.initialize)&&this.initialize(this.options)},e.Config.extend=e.extend,e.Config.create=e.create,e.Config.design=e.design,c.extend(e.Config.prototype,{_type:"M.Config",get:function(a){return this[a]}}),e.Logger=e.Object.design({filter:[],_type:"M.Logger",_OUTPUT_LOG:0,_OUTPUT_DEBUG:1,_OUTPUT_WARN:2,_OUTPUT_ERROR:3,_LEVEL_TIME_END:4,_times:[],_counts:[],_appRunsInNotDebugMode:NO,_init:function(){c.isUndefined(console)&&(window.console={},console.log=console.debug=console.warn=console.error=function(){}),this._appRunsInNotDebugMode=NO},log:function(){this._print(this._OUTPUT_LOG,arguments)},warn:function(){this._print(this._OUTPUT_WARN,arguments)},error:function(a,b){this._print(this._OUTPUT_ERROR,b,a)},time:function(a){return this._appRunsInNotDebugMode?void 0:c.isUndefined(console.time2)?(this._time(a),void 0):(console.time(a),void 0)},timeEnd:function(a){return this._appRunsInNotDebugMode?void 0:c.isUndefined(console.timeEnd2)?(this._timeEnd(a),void 0):(console.timeEnd(a),void 0)},count:function(a){return this._appRunsInNotDebugMode?void 0:c.isUndefined(console.count2)?(this._count(a),void 0):(console.count(a),void 0)},_print:function(a,b){if(!this._appRunsInNotDebugMode){a=a||this._OUTPUT_LOG,b=Array.prototype.slice.call(b),1===b.length&&b.splice(0,0,e.CONST.LOGGER.TAG_ALL);var d=b[0];if(!this._preventOutputByTag(d)){var f="";if(a<this._OUTPUT_ERROR)if(c.isArray(d)&&this.filter.length>0){var g=c.without(this.filter,d);f="["+g+"]"}else d.length>0&&(f="["+d+"]");switch(b.length>1&&(f===e.CONST.LOGGER.TAG_ALL?b.splice(0,1):b[0]=f),a){case this._OUTPUT_LOG:console.log.apply(console,b);break;case this._OUTPUT_WARN:b.splice(0,0,"WARNING:"),console.warn.apply(console,b);break;case this._OUTPUT_ERROR:b.splice(0,0,"ERROR:"),console.error.apply(console,b);break;case this._OUTPUT_DEBUG:console.debug.apply(console,b);break;default:console.log.apply(console,b)}}}},_time:function(a){var b=c.find(this._times,function(b){return b.label===a});b||this._times.push({label:a,time:(new Date).getTime()})},_timeEnd:function(a){var b=c.find(this._times,function(b){return b.label===a});if(b){var d=(new Date).getTime(),e=(d-b.time)/1e3,f=this._times.indexOf(b);this._print(this._OUTPUT_DEBUG,[b.label+": "+e+"ms"]),this._times.splice(f,1)}},_count:function(a){var b=c.find(this._counts,function(b){return b.label===a});void 0===b?(this._counts.push({label:a,count:1}),b=c.last(this._counts)):b.count++,this._print(this._OUTPUT_DEBUG,[b.label+": "+b.count])},_preventOutputByTag:function(a){if(this.filter.length>0&&-1===this.filter.indexOf(e.CONST.TAG_ALL))if(c.isString(a)){if(-1===this.filter.indexOf(a))return YES}else if(c.isArray(a)&&c.difference(a,this.filter).length===a.length)return YES;return NO}}),e.Controller=function(a){this.options=a||{},c.isFunction(this.initialize)&&this.initialize(this.options)},e.Controller.extend=e.extend,e.Controller.create=e.create,e.Controller.design=e.design,c.extend(e.Controller.prototype,b.Events,{_type:"M.Controller",initialize:function(){return this},applicationStart:function(){},show:function(){},set:function(a,b){this[a]=b,this.trigger(a,b)},get:function(a){return this[a]},applicationReady:function(){},apply:function(b,c){var d=a[e.APPLICATION_NAME];d.isInitialLoad?(this.applicationStart.apply(this,c),d.isInitialLoad=!1,d._initReady()):this.show.apply(this,c)}}),e.Application=e.Controller.extend({_type:"M.Application",Models:null,Collections:null,Views:null,Controllers:null,Routers:null,_isReady:NO,_debugView:null,isInitialLoad:!0,_layout:null,_config:null,initialize:function(a){return this.Models={},this.Collections={},this.Views={},this.Controllers={},this.Routers={},e.APPLICATION_NAME=a.name,this._config=e.Config.design(a),this},start:function(a){return this.router=e.Router.design(a.routing),this._initLocale(a).then(function(){b.history.start()}),this},setLayout:function(a){this._layout&&(this._layout.destroy(),this._layout=null),this._layout=a,this._layout.render(),d("#main").html(this._layout.$el)},getLayout:function(){return this._layout},navigate:function(a){if(this._layout&&this._layout.isAnimating&&this._layout.isAnimating())return!1;var d=a.route,e="";a.params&&(e=c.isArray(a.params)?a.params.join("/"):a.params,d+="/"),this._layout&&this._layout.setTransition(a.transition);var f=a.options||!0;b.history.navigate(d+e,f)},_initLocale:function(){var a=d.Deferred();return e.I18N.on(e.CONST.I18N.LOCALE_CHANGED,function(){a.resolve()}),this._config&&this.getConfig("locales")?(e.I18N.setLocales(this.getConfig("locales")),e.I18N.setLocale(moment.lang())):a.resolve(),a.promise()},_initReady:function(){this._isReady||(this._initDebugView(),FastClick.attach(document.body),c.each(Object.getPrototypeOf(this.router),function(a){e.isController(a)&&a.applicationReady()},this),this._isReady=YES)},_initDebugView:function(){this.getConfig("debugView")&&(this._debugView=e.DebugView.create())},getConfig:function(a){return this._config.get(a)}}),e.Router=b.Router.extend(),e.Router.create=e.create,e.Router.design=e.design,c.extend(e.Router.prototype,e.Object,{_type:"M.Router"}),e.ViewManager=e.Object.design({_allViews:null,registerView:function(a){return c.isObject(this._allViews)||(this._allViews={}),a.cid?(this._allViews[a.cid]?console.warn("view already registered"):this._allViews[a.cid]=a,void 0):(console.warn("view has no cid"),void 0)},getView:function(a,b){var d=[];return a?this._allViews[a]?(d.push(this._allViews[a]),d):a.DOCUMENT_NODE?(d.push(this._getViewByDom(a)),d):"string"==typeof a?e.isView(b)?(this._getViewInScope(a,b,d),d):("string"==typeof a&&c.each(this._allViews,function(c){c.childViews&&c.childViews.hasOwnProperty(a)&&("string"==typeof b?c.childViews[a]&&c.childViews[a]._type===b&&d.push(c.childViews[a]):d.push(c.childViews[a]))},this),d):d:d},_getViewByDom:function(a){return c.find(this._allViews,function(b){return b.el===a})},_getViewInScope:function(a,b,c){if(b.childViews!=={}){b.childViews.hasOwnProperty(a)&&c.push(b.childViews[a]);for(var d in b.childViews)this._getViewInScope(a,b.childViews[d],c)}}}),Modernizr.Detectizr.detect({detectScreen:!1}),e.Environment=Modernizr.Detectizr,e.Environment.isLowerThanAndroid4="android"===Modernizr.Detectizr.device.model&&parseInt(Modernizr.Detectizr.device.osVersion,10)<4,e.Environment.isLowerThaniPhone4S="ios"===Modernizr.Detectizr.device.os&&(document.width<=320||document.width<=480),e.I18NItem=e.Object.design({_type:"M.I18NItem",key:null,placeholder:null,create:function(a,b){return a?(this.key=a,b&&(this.placeholder=b),c.extend({},this)):null}}),e.I18N=c.extend(b.Events,e.Object.design({_type:"M.I18N",_availableLocales:[],_activeLocale:null,_dictionary:[],setLocales:function(a){return a&&c.isArray(a)&&a.length>0?(this._availableLocales=a,!0):(console.log("No locales given!"),!1)},getLocales:function(){return this._availableLocales},setLocale:function(a){this._activeLocale=a,this.loadFileForLocale()},getLocale:function(){return this._activeLocale},get:function(a,b){return e.I18NItem.create(a,b)},l:function(a,b){if(void 0===this._dictionary[this._activeLocale]||void 0===a||""===a||null===a)return"";var d=this._dictionary[this._activeLocale];return d=d[a],d?b&&c.each(b,function(a,b){d=d.replace("{{"+b+"}}",a)}):(d="MISSING TRANSLATION "+this._activeLocale+": "+a,console.log(d)),d},loadFileForLocale:function(){var a="i18n/"+this._activeLocale+".js";moment.lang(this._activeLocale.substr(0,2));var b=this;void 0===this._dictionary[b._activeLocale]?d.getJSON(a).success(function(a){b._setDictionary(a)}).error(function(b,c,d){"parsererror"===c?console.log("It's seem that the i18n file "+a+" is corrupt! "+d.message):console.log(arguments)}):this._triggerLocaleChangedEvent()},_setDictionary:function(a){var b=this._parseObject(a);this._dictionary[this._activeLocale]=b,this._triggerLocaleChangedEvent()},_triggerLocaleChangedEvent:function(){this.trigger(e.CONST.I18N.LOCALE_CHANGED,this._activeLocale)},_parseObject:function(a){var b={};for(var d in a)if(a.hasOwnProperty(d))if(c.isObject(a[d])){var e=this._parseObject(a[d]);for(var f in e)e.hasOwnProperty(f)&&(b[d+"."+f]=e[f])}else b[d]=a[d];return b}})),e.ObjectID=function(a){e.ObjectID.counter=e.ObjectID.counter||parseInt(Math.random()*Math.pow(16,6)),e.ObjectID.machineId=e.ObjectID.machineId||parseInt(Math.random()*Math.pow(16,6)),e.ObjectID.processId=e.ObjectID.processId||parseInt(Math.random()*Math.pow(16,4)),this._ObjectID(a)},e.ObjectID._looksLikeObjectID=function(a){return 24===a.length&&a.match(/^[0-9a-f]*$/)},c.extend(e.ObjectID.prototype,{_str:"",_ObjectID:function(a){if(a){if(a=a.toLowerCase(),!e.ObjectID._looksLikeObjectID(a))throw new Error("Invalid hexadecimal string for creating an ObjectID");this._str=a}else this._str=this._hexString(8,(new Date).getTime()/1e3)+this._hexString(6,e.ObjectID.machineId)+this._hexString(4,e.ObjectID.processId)+this._hexString(6,e.ObjectID.counter++);return this._str},_hexString:function(a,b){b=b||parseInt(Math.random()*Math.pow(16,a));for(var c=b.toString(16);c.length<a;)c="0"+c;return c.substr(0,a)},toString:function(){return"ObjectID('"+this._str+"')"},equals:function(a){return a instanceof this._ObjectID&&this.valueOf()===a.valueOf()},clone:function(){return new e.ObjectID(this._str)},typeName:function(){return"oid"},getTimestamp:function(){return 1e3*parseInt(this._str.substr(0,8),16)},getMachineId:function(){return parseInt(this._str.substr(8,6),16)},getProcessId:function(){return parseInt(this._str.substr(14,4),16)},getCounter:function(){return parseInt(this._str.substr(18,6),16)},valueOf:function(){return this._str},toJSON:function(){return this._str},toHexString:function(){return this._str},_selectorIsId:function(a){return"string"==typeof a||"number"==typeof a||a instanceof e.ObjectId},_selectorIsIdPerhapsAsObject:function(a){return this._selectorIsId(a)||a&&"object"==typeof a&&a._id&&this._selectorIsId(a._id)&&1===c.size(a)},_idsMatchedBySelector:function(a){if(this._selectorIsId(a))return[a];if(!a)return null;if(c.has(a,"_id"))return this._selectorIsId(a._id)?[a._id]:a._id&&a._id.$in&&c.isArray(a._id.$in)&&!c.isEmpty(a._id.$in)&&c.all(a._id.$in,this._selectorIsId)?a._id.$in:null;if(a.$and&&c.isArray(a.$and))for(var b=0;b<a.$and.length;++b){var d=this._idsMatchedBySelector(a.$and[b]);if(d)return d}return null}}),e.UniqueId=e.Object.design({uuid:function(a,b){var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),d=[];b=b||c.length;var e;if(a)for(e=0;a>e;e++)d[e]=c[0|Math.random()*b];else{var f;for(d[8]=d[13]=d[18]=d[23]="-",d[14]="4",e=0;36>e;e++)d[e]||(f=0|16*Math.random(),d[e]=c[19===e?3&f|8:f])}return d.join("")}}),e.Base64=e.Object.design({type:"M.Base64",_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(a){for(var b,c="",d=new Array(4),e=0,f=0;e<a.length;){b=new Array(3);for(var g=0;g<b.length;g++)b[g]=e<a.length?255&a.charCodeAt(e++):0;switch(d[0]=b[0]>>2,d[1]=(3&b[0])<<4|b[1]>>4,d[2]=(15&b[1])<<2|b[2]>>6,d[3]=63&b[2],f=e-(a.length-1)){case 2:d[3]=64,d[2]=64;break;case 1:d[3]=64}for(g=0;g<d.length;g++)c+=this._keyStr.charAt(d[g])}return c},encode:function(a){var b,c,d,f,g,h,i,j="",k=0;for(a=e.Cypher.utf8Encode(a);k<a.length;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),f=b>>2,g=(3&b)<<4|c>>4,h=(15&c)<<2|d>>6,i=63&d,isNaN(c)?h=i=64:isNaN(d)&&(i=64),j+=this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h)+this._keyStr.charAt(i);return j},binaryEncode:function(a){for(var b,c,d,e,f,g,h,i="",j=0;j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i+=this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,f,g,h,i,j="",k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<a.length;)f=this._keyStr.indexOf(a.charAt(k++)),g=this._keyStr.indexOf(a.charAt(k++)),h=this._keyStr.indexOf(a.charAt(k++)),i=this._keyStr.indexOf(a.charAt(k++)),b=f<<2|g>>4,c=(15&g)<<4|h>>2,d=(3&h)<<6|i,j+=String.fromCharCode(b),64!==h&&(j+=String.fromCharCode(c)),64!==i&&(j+=String.fromCharCode(d));return e.Cypher.utf8Decode(j)}}),e.SHA256=e.Object.design({type:"M.SHA256",chrsz:8,hexcase:0,hash:function(a){return a=e.Cypher.utf8Encode(a),this.binb2hex(this.coreSha256(this.str2binb(a),a.length*this.chrsz))},safeAdd:function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},S:function(a,b){return a>>>b|a<<32-b},R:function(a,b){return a>>>b},Ch:function(a,b,c){return a&b^~a&c},Maj:function(a,b,c){return a&b^a&c^b&c},Sigma0256:function(a){return this.S(a,2)^this.S(a,13)^this.S(a,22)},Sigma1256:function(a){return this.S(a,6)^this.S(a,11)^this.S(a,25)},Gamma0256:function(a){return this.S(a,7)^this.S(a,18)^this.R(a,3)},Gamma1256:function(a){return this.S(a,17)^this.S(a,19)^this.R(a,10)},coreSha256:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),p=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),q=new Array(64);for(a[b>>5]|=128<<24-b%32,a[(b+64>>9<<4)+15]=b,k=0;k<a.length;k+=16){for(c=p[0],d=p[1],e=p[2],f=p[3],g=p[4],h=p[5],i=p[6],j=p[7],l=0;64>l;l++)q[l]=16>l?a[l+k]:this.safeAdd(this.safeAdd(this.safeAdd(this.Gamma1256(q[l-2]),q[l-7]),this.Gamma0256(q[l-15])),q[l-16]),m=this.safeAdd(this.safeAdd(this.safeAdd(this.safeAdd(j,this.Sigma1256(g)),this.Ch(g,h,i)),o[l]),q[l]),n=this.safeAdd(this.Sigma0256(c),this.Maj(c,d,e)),j=i,i=h,h=g,g=this.safeAdd(f,m),f=e,e=d,d=c,c=this.safeAdd(m,n);p[0]=this.safeAdd(c,p[0]),p[1]=this.safeAdd(d,p[1]),p[2]=this.safeAdd(e,p[2]),p[3]=this.safeAdd(f,p[3]),p[4]=this.safeAdd(g,p[4]),p[5]=this.safeAdd(h,p[5]),p[6]=this.safeAdd(i,p[6]),p[7]=this.safeAdd(j,p[7])}return p},str2binb:function(a){for(var b=[],c=(1<<this.chrsz)-1,d=0;d<a.length*this.chrsz;d+=this.chrsz)b[d>>5]|=(a.charCodeAt(d/this.chrsz)&c)<<24-d%32;return b},binb2hex:function(a){for(var b=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>8*(3-d%4)+4&15)+b.charAt(a[d>>2]>>8*(3-d%4)&15);return c}}),e.Cypher=e.Object.design({type:"M.Cypher",defaultDecoder:e.Base64,defaultEncoder:e.Base64,defaultHasher:e.SHA256,decode:function(a,b){return b&&b.decode?b.decode(a):this.defaultDecoder.decode(a)},encode:function(a,b){return b&&b.encode?b.encode(a):this.defaultEncoder.encode(a)},hash:function(a,b){return b&&b.hash?b.hash(a):this.defaultHasher.hash(a)},utf8Encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},utf8Decode:function(a){var b,c,d,e,f,g="";for(b=c=d=e=0;b<a.length;)c=a.charCodeAt(b),128>c?(g+=String.fromCharCode(c),b++):c>191&&224>c?(e=a.charCodeAt(b+1),g+=String.fromCharCode((31&c)<<6|63&e),b+=2):(e=a.charCodeAt(b+1),f=a.charCodeAt(b+2),g+=String.fromCharCode((15&c)<<12|(63&e)<<6|63&f),b+=3);return g}}),e.Date={create:function(){var a=moment.apply(this,arguments);return c.extend(a,this)}},e.Request=e.Object.design({_type:"M.Request",_id:null,_request:null,method:null,url:null,timeout:null,data:null,init:function(a){return this.design(a)},_normalize:function(a){return a=a&&"object"==typeof a?a:{},a.callbacks=a.callbacks||{},a},_init:function(){if(Object.getPrototypeOf(this)===e.Request&&!this.url)throw e.Exception.NO_REQUEST_URL_SPECIFIED.getException();this._id=e.UniqueId.uuid(),this.method=this.method||"GET",this.data=this.data||"",("number"!=typeof this.timeout||this.timeout<0)&&delete this.timeout},getId:function(){return this._id},send:function(){this._request=d.ajax({type:this.method,url:this.url,timeout:this.timeout,data:this.data,context:this,beforeSend:this._handleBeforeSend,success:this._handleSuccess,error:this._handleError})},cancel:function(){this._request&&this._request.abort(),this._request=null},_handleBeforeSend:function(a){this.handleCallback(this.callbacks.beforeSend,{id:this.getId(),xhr:a})},_handleSuccess:function(a,b,c){this.handleCallback(this.callbacks.success,{id:this.getId(),data:a,status:b,xhr:c}),this.cancel()},_handleError:function(a,b,c){this.handleCallback(this.callbacks.error,{id:this.getId(),xhr:a,status:b,error:c}),this.cancel()},getLocation:function(a){var b=document.createElement("a");return b.href=a||this.url,""===b.host&&(b.href=b.href),b}}),e.RequestManager=e.Object.design({_type:"M.RequestManager",baseUrl:null,method:null,timeout:null,_requests:null,init:function(a){return this.design(a)},_normalize:function(a){return a=a&&"object"==typeof a?a:{},a.callbacks=a.callbacks||{},a.baseUrl=a.baseUrl||a.url,a},_init:function(){if(Object.getPrototypeOf(this)===e.RequestManager&&!this.baseUrl)throw e.Exception.NO_REQUEST_MANAGER_BASE_URL_SPECIFIED.getException();this._requests={},this.baseUrl&&this.baseUrl.lastIndexOf("/")===this.baseUrl.length-1&&(this.baseUrl=this.baseUrl.substr(0,this.baseUrl.length-1)),this.url&&delete this.url,this.method=this.method||"GET",("number"!=typeof this.timeout||this.timeout<0)&&delete this.timeout},doRequest:function(a){a=a&&"object"==typeof a?a:{};var b=e.Request.init({url:this.getUrl(a),timeout:isNaN(a.timeout)?this.timeout:a.timeout,method:a.method?a.method:this.method,data:a.data?a.data:"",callbacks:{beforeSend:{target:this,action:"_handleBeforeSend"},success:{target:this,action:"_handleSuccess"},error:{target:this,action:"_handleError"}}});return this._requests[b.getId()]=b,b.send(),b},getUrl:function(a){return a.path&&"/"!==a.path[0]&&(a.path="/"+a.path),this.baseUrl+(a.path?a.path:"")},_handleBeforeSend:function(a){this.handleCallback(this.callbacks.beforeSend,a)},_handleSuccess:function(a){this.handleCallback(this.callbacks.success,a),this.requestFinished(a.id)},_handleError:function(a){this.handleCallback(this.callbacks.error,a),this.requestFinished(a.id)},requestFinished:function(a){this._requests&&this._requests[a]&&(this._requests[a]=null,delete this._requests[a])},cancelRequest:function(a){this._requests&&this._requests[a]&&(this._requests[a].cancel(),this.requestFinished(a))},cancelAllRequest:function(){c.each(this._requests,function(a,b){this.cancelRequest(b)},this)}}),e.Field=function(a){this.merge(a),this.initialize.apply(this,arguments)},e.Field.extend=e.extend,e.Field.create=e.create,e.Field.design=e.design,c.extend(e.Field.prototype,e.Object,{_type:"M.Field",name:null,type:null,index:null,defaultValue:void 0,length:null,required:NO,persistent:YES,initialize:function(){},merge:function(a){a=c.isString(a)?{type:a}:a||{},this.name=c.isUndefined(a.name)?this.name:a.name,this.type=c.isUndefined(a.type)?this.type:a.type,this.index=c.isUndefined(a.index)?this.index:a.index,this.defaultValue=c.isUndefined(a.defaultValue)?this.defaultValue:a.defaultValue,this.length=c.isUndefined(a.length)?this.length:a.length,this.required=c.isUndefined(a.required)?this.required:a.required,this.persistent=c.isUndefined(a.persistent)?this.persistent:a.persistent},transform:function(a,b){b=b||this.type;try{if(c.isUndefined(a))return this.defaultValue;if(b===e.CONST.TYPE.STRING||b===e.CONST.TYPE.TEXT)return c.isObject(a)?JSON.stringify(a):c.isNull(a)?"null":a.toString();if(b===e.CONST.TYPE.INTEGER)return parseInt(a);if(b===e.CONST.TYPE.BOOLEAN)return a===!0||"true"===a;if(b===e.CONST.TYPE.FLOAT)return parseFloat(a);if(b===e.CONST.TYPE.OBJECT||b===e.CONST.TYPE.ARRAY){if(!c.isObject(a))return c.isString(a)?JSON.parse(a):null}else if(b===e.CONST.TYPE.DATE){if(!e.Date.isPrototypeOf(a)){var d=a?e.Date.create(a):null;return d&&d.isValid()?d:null}}else if(b===e.CONST.TYPE.OBJECTID&&!e.ObjectID.prototype.isPrototypeOf(a))return c.isString(a)?new e.ObjectID(a):null;return a}catch(f){e.Logger.error(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,"Failed converting value! "+f.message)}},equals:function(a,b){var d=this.transform(a),e=this.transform(b);return this._equals(d,e,c.isArray(d))},isBinary:function(a){return"undefined"!=typeof Uint8Array&&a instanceof Uint8Array||a&&a.$Uint8ArrayPolyfill},detectType:function(a){return c.isNumber(a)?e.CONST.TYPE.FLOAT:c.isString(a)?e.CONST.TYPE.STRING:c.isBoolean(a)?e.CONST.TYPE.BOOLEAN:c.isArray(a)?e.CONST.TYPE.ARRAY:c.isNull(a)?e.CONST.TYPE.NULL:c.isDate(a)||e.Date.isPrototypeOf(a)?e.CONST.TYPE.DATE:e.ObjectID.prototype.isPrototypeOf(a)?e.CONST.TYPE.OBJECTID:this.isBinary(a)?e.CONST.TYPE.BINARY:e.CONST.TYPE.OBJECT},typeOrder:function(a){switch(a){case e.CONST.TYPE.NULL:return 0;case e.CONST.TYPE.FLOAT:return 1;case e.CONST.TYPE.STRING:return 2;case e.CONST.TYPE.OBJECT:return 3;case e.CONST.TYPE.ARRAY:return 4;case e.CONST.TYPE.BINARY:return 5;case e.CONST.TYPE.DATE:return 6}return-1},_equals:function(a,b,d){var e,f=this;if(a===b)return!0;if(!a||!b)return!1;if(!c.isObject(a)||!c.isObject(b))return!1;if(a instanceof Date&&b instanceof Date)return a.valueOf()===b.valueOf();if(this.isBinary(a)&&this.isBinary(b)){if(a.length!==b.length)return!1;for(e=0;e<a.length;e++)if(a[e]!==b[e])return!1;return!0}if(c.isFunction(a.equals))return a.equals(b);if(c.isArray(a)){if(!c.isArray(b))return!1;if(a.length!==b.length)return!1;for(e=0;e<a.length;e++)if(!f.equals(a[e],b[e],d))return!1;return!0}var g;if(d){var h=[];return c.each(b,function(a,b){h.push(b)}),e=0,g=c.all(a,function(a,c){return e>=h.length?!1:c!==h[e]?!1:f.equals(a,b[h[e]],d)?(e++,!0):!1}),g&&e===h.length}return e=0,g=c.all(a,function(a,g){return c.has(b,g)?f.equals(a,b[g],d)?(e++,!0):!1:!1}),g&&c.size(b)===e},_cmp:function(a,b){if(void 0===a)return void 0===b?0:-1;if(void 0===b)return 1;var c=0,d=this.detectType(a),f=this.detectType(b),g=this.typeOrder(d),h=this.typeOrder(f);if(g!==h)return h>g?-1:1;if(d!==f)throw new Error("Missing type coercion logic in _cmp");if(7===d&&(d=f=2,a=a.toHexString(),b=b.toHexString()),d===e.CONST.TYPE.DATE&&(d=f=1,a=a.getTime(),b=b.getTime()),d===e.CONST.TYPE.FLOAT)return a-b;if(f===e.CONST.TYPE.STRING)return b>a?-1:a===b?0:1;if(d===e.CONST.TYPE.OBJECT){var i=function(a){var b=[];for(var c in a)b.push(c),b.push(a[c]);return b};return this._cmp(i(a),i(b))}if(d===e.CONST.TYPE.ARRAY)for(c=0;;c++){if(c===a.length)return c===b.length?0:-1;if(c===b.length)return 1;var j=this._cmp(a[c],b[c]);if(0!==j)return j}if(d===e.CONST.TYPE.BINARY){if(a.length!==b.length)return a.length-b.length;for(c=0;c<a.length;c++){if(a[c]<b[c])return-1;if(a[c]>b[c])return 1}return 0}if(d===e.CONST.TYPE.BOOLEAN)return a?b?0:1:b?-1:0;if(d===e.CONST.TYPE.NULL)return 0;throw new Error("Unknown type to sort")}}),e.Entity=function(a){var b=this.fields;this.fields={},this._mergeFields(b),a=a||{},a.fields&&this._mergeFields(a.fields),this.typeMapping=a.typeMapping||this.typeMapping;var c=a.collection,d=a.model||(c?c.prototype.model:null);this.idAttribute=a.idAttribute||this.idAttribute||(d?d.prototype.idAttribute:""),this._updateFields(this.typeMapping),this.initialize.apply(this,arguments)},e.Entity.from=function(a,b){if(e.Entity.prototype.isPrototypeOf(a))b&&b.typeMapping&&a._updateFields(b.typeMapping);else if(c.isFunction(a)&&e.Entity.prototype.isPrototypeOf(a.prototype)){var d=a;a=new d(b)}else{"string"==typeof a&&(a={name:a});var f=e.Entity.extend(a);a=new f(b)}return a},e.Entity.extend=e.extend,e.Entity.create=e.create,e.Entity.design=e.design,c.extend(e.Entity.prototype,e.Object,{_type:"M.Entity",name:"",idAttribute:"",fields:{},initialize:function(){},getFields:function(){return this.fields},getField:function(a){return this.fields[a]},getFieldName:function(a){var b=this.getField(a);return b&&b.name?b.name:a},getKey:function(){return this.idAttribute||e.Model.idAttribute},getKeys:function(){return this.splitKey(this.getKey())},splitKey:function(a){var b=[];return c.isString(a)&&c.each(a.split(","),function(a){var c=a.trim();c&&b.push(c)}),b},_mergeFields:function(a){c.isObject(this.fields)||(this.fields={});var b=this;c.isObject(a)&&c.each(a,function(a,c){b.fields[c]?b.fields[c].merge(a):b.fields[c]=new e.Field(a)})},_updateFields:function(a){var b=this;c.each(this.fields,function(c,d){c.persistent===NO?delete b.fields[d]:(c.name||(c.name=d),a&&a[c.type]&&(c.type=a[c.type]))})},toAttributes:function(a,b,d){if(d=d||this.fields,a&&!c.isEmpty(d)){var e,f={};return c.each(d,function(b,d){e=c.isFunction(a.get)?a.get(b.name):a[b.name],f[d]=e}),f}return a},fromAttributes:function(a,b){if(b=b||this.fields,a&&!c.isEmpty(b)){var d={};return c.each(b,function(b,e){var f=c.isFunction(a.get)?a.get(e):a[e];f=b.transform(f),c.isUndefined(f)||(d[b.name]=f)}),d}return a},setId:function(a,b){if(a&&b){var d=this.getKey()||a.idAttribute;d&&(c.isFunction(a.set)?a.set(d,b):a[d]=b)}return a},getId:function(a){if(a){var b=this.getKey()||a.idAttribute;if(b)return c.isFunction(a.get)?a.get(b):a[b]}}}),e.Security=e.Object.design({logon:function(a,b){var c=a?a.credentials:null;if(c)switch(c.type){case"basic":return this.logonBasicAuth(a,b)}this.handleCallback(b)},logonBasicAuth:function(a,b){var c=a.credentials;a.beforeSend=function(a){e.Security.setBasicAuth(a,c)},this.handleCallback(b)},setBasicAuth:function(a,b){if(b&&b.username&&a&&e.Base64){var c=e.Base64.encode(encodeURIComponent(b.username+":"+(b.password||"")));a.setRequestHeader("Authorization","Basic "+c)}}}),e.Model=b.Model.extend({constructor:function(a,c){this.init(a,c),b.Model.apply(this,arguments)}}),e.Model.create=e.create,e.Model.design=e.design,c.extend(e.Model.prototype,e.Object,{_type:"M.Model",isModel:YES,entity:null,defaults:{},changedSinceSync:{},logon:e.Security.logon,init:function(a,b){b=b||{},this.collection=b.collection||this.collection,this.idAttribute=b.idAttribute||this.idAttribute,this.store=this.store||(this.collection?this.collection.store:null)||b.store,this.store&&c.isFunction(this.store.initModel)&&this.store.initModel(this,b),this.entity=this.entity||(this.collection?this.collection.entity:null)||b.entity,this.entity&&(this.entity=e.Entity.from(this.entity,{model:this.constructor,typeMapping:b.typeMapping}),this.idAttribute=this.entity.idAttribute||this.idAttribute),this.credentials=this.credentials||(this.collection?this.collection.credentials:null)||b.credentials,this.on("change",this.onChange,this),this.on("sync",this.onSync,this)},sync:function(a,d,e){e=e||{},e.credentials=e.credentials||this.credentials;var f=(e.store?e.store:null)||this.store,g=this,h=arguments;this.logon(e,function(){return f&&c.isFunction(f.sync)?f.sync.apply(g,h):b.sync.apply(g,h)})},onChange:function(a){var b=a.changedAttributes();if(c.isObject(b))for(var d in b)this.changedSinceSync[d]=b[d]},onSync:function(){this.changedSinceSync={}},getUrlRoot:function(){if(this.urlRoot)return c.isFunction(this.urlRoot)?this.urlRoot():this.urlRoot;if(this.collection)return this.collection.getUrlRoot();if(this.url){var a=c.isFunction(this.url)?this.url():this.url;return a&&this.id&&a.indexOf(this.id)>0?a.substr(0,a.indexOf(this.id)):a}},toJSON:function(a){a=a||{};var b=a.entity||this.entity;return e.isEntity(b)?b.fromAttributes(a.attrs||this.attributes):a.attrs||c.clone(this.attributes)},parse:function(a,b){b=b||{};var c=b.entity||this.entity;return e.isEntity(c)?c.toAttributes(a):a}}),e.Collection=b.Collection.extend({constructor:function(a){this.init(a),b.Collection.apply(this,arguments)}}),e.Collection.create=e.create,e.Collection.design=e.design,c.extend(e.Collection.prototype,e.Object,{_type:"M.Collection",isCollection:YES,model:e.Model,entity:null,options:null,logon:e.Security.logon,init:function(a){a=a||{},this.store=a.store||this.store||(this.model?this.model.prototype.store:null),this.entity=a.entity||this.entity||(this.model?this.model.prototype.entity:null),this.options=a.options||this.options;var b=this.entity||this.entityFromUrl(this.url);b&&(this.entity=e.Entity.from(b,{model:this.model,typeMapping:a.typeMapping})),this._updateUrl(),this.store&&c.isFunction(this.store.initCollection)&&this.store.initCollection(this,a)
},entityFromUrl:function(a){if(a){var b=e.Request.getLocation(this.url).pathname.match(/([^\/]+)\/?$/);if(b&&b.length>1)return b[1]}},sort:function(a){c.isObject(a&&a.sort)&&(this.comparator=e.DataSelector.compileSort(a.sort)),b.Collection.prototype.sort.apply(this,arguments)},select:function(a){var b=a&&a.query?e.DataSelector.create(a.query):null,c=e.Collection.create(null,{model:this.model});return a&&a.sort&&(c.comparator=e.DataSelector.compileSort(a.sort)),this.each(function(a){(!b||b.matches(a.attributes))&&c.add(a)}),c},destroy:function(a){a=a||{};var b=a.success;if(this.length>0){a.success=function(){0===this.length&&b&&b()};for(var c;c=this.first();)this.sync("delete",c,a),this.remove(c)}else b&&b()},sync:function(a,d,e){e=e||{},e.credentials=e.credentials||this.credentials;var f=(e.store?e.store:null)||this.store,g=this,h=arguments;this.logon(e,function(){return f&&c.isFunction(f.sync)?f.sync.apply(g,h):b.sync.apply(g,h)})},save:function(){this.each(function(a){a.save()})},getUrlParams:function(a){a=a||this.getUrl();var b=a.match(/\?([^#]*)/),d={};return b&&b.length>1&&c.each(b[1].split("&"),function(a){var b=a.split("=");d[b[0]]=b[1]}),d},getUrl:function(){return(c.isFunction(this.url)?this.url():this.url)||""},getUrlRoot:function(){var a=this.getUrl();return a?a.indexOf("?")>=0?a.substr(0,a.indexOf("?")):a:""},applyFilter:function(a){this.trigger("filter",this.filter(a))},_updateUrl:function(){var a=this.getUrlParams();if(this.options&&(this.url=this.getUrlRoot(),this.options.query&&(a.query=encodeURIComponent(JSON.stringify(this.options.query))),this.options.fields&&(a.fields=encodeURIComponent(JSON.stringify(this.options.fields))),this.options.sort&&(a.sort=encodeURIComponent(JSON.stringify(this.options.sort))),!c.isEmpty(a))){this.url+="?";var b=[];for(var d in a)b.push(d+(a[d]?"="+a[d]:""));this.url+=b.join("&")}}}),e.DataSelector=e.Object.design({_type:"M.DataSelector",_selector:null,create:function(a){var b=this.design({_selector:null});return b.init(a),b},init:function(a){this._selector=this.compileSelector(a)},matches:function(a){return c.isFunction(this._selector)?this._selector(a):!1},hasOperators:function(a){var b;for(var c in a){var d="$"===c.substr(0,1);if(void 0===b)b=d;else if(b!==d)throw new Error("Inconsistent selector: "+a)}return!!b},compileSelector:function(a){if(c.isFunction(a))return function(b){return a.call(b)};if(this._selectorIsId(a))return function(b){var d=c.isFunction(b.getId)?b.getId():b._id||b.id;return e.Field.prototype.equals(d,a)};if(!a||"_id"in a&&!a._id)return function(){return!1};if(c.isBoolean(a)||c.isArray(a)||e.Field.prototype.isBinary(a))throw new Error("Invalid selector: "+a);return this.compileDocSelector(a)},compileDocSelector:function(a){var b=e.DataSelector,d=[];return c.each(a,function(a,e){if("$"===e.substr(0,1)){if(!c.has(b.LOGICAL_OPERATORS,e))throw new Error("Unrecognized logical operator: "+e);d.push(b.LOGICAL_OPERATORS[e](a))}else{var f=b._makeLookupFunction(e),g=b.compileValueSelector(a);d.push(function(a){var b=f(a);return c.any(b,g)})}}),function(a){var b=c.isFunction(a.getData)?a.getData():a;return c.all(d,function(a){return a(b)})}},compileValueSelector:function(a){var b=e.DataSelector;if(null===a)return function(a){return b._anyIfArray(a,function(a){return null===a})};if(!c.isObject(a))return function(c){return b._anyIfArray(c,function(b){return b===a})};if(c.isRegExp(a))return function(d){return c.isUndefined(d)?!1:b._anyIfArray(d,function(b){return a.test(b)})};if(c.isArray(a))return function(d){return c.isArray(d)?b._anyIfArrayPlus(d,function(c){return b._equal(a,c)}):!1};if(this.hasOperators(a)){var d=[];return c.each(a,function(e,f){if(!c.has(b.VALUE_OPERATORS,f))throw new Error("Unrecognized operator: "+f);d.push(b.VALUE_OPERATORS[f](e,a.$options))}),function(a){return c.all(d,function(b){return b(a)})}}return function(c){return b._anyIfArray(c,function(c){return b._equal(a,c)})}},_makeLookupFunction:function(a){var b,d,e,f=a.indexOf(".");if(-1===f)b=a;else{b=a.substr(0,f);var g=a.substr(f+1);d=this._makeLookupFunction(g),e=/^\d+(\.|$)/.test(g)}return function(a){if(null===a)return[void 0];var f=a[b];return d?c.isArray(f)&&0===f.length?[void 0]:((!c.isArray(f)||e)&&(f=[f]),Array.prototype.concat.apply([],c.map(f,d))):[f]}},_anyIfArray:function(a,b){return c.isArray(a)?c.any(a,b):b(a)},_anyIfArrayPlus:function(a,b){return b(a)?!0:c.isArray(a)&&c.any(a,b)},_selectorIsId:function(a){return c.isString(a)||c.isNumber(a)},_equal:function(a,b){return e.Field.prototype._equals(a,b,!0)},_cmp:function(a,b){return e.Field.prototype._cmp(a,b)},LOGICAL_OPERATORS:{$and:function(a){if(!c.isArray(a)||c.isEmpty(a))throw new Error("$and/$or/$nor must be nonempty array");var b=c.map(a,e.DataSelector.compileDocSelector);return function(a){return c.all(b,function(b){return b(a)})}},$or:function(a){if(!c.isArray(a)||c.isEmpty(a))throw new Error("$and/$or/$nor must be nonempty array");var b=c.map(a,e.DataSelector.compileDocSelector);return function(a){return c.any(b,function(b){return b(a)})}},$nor:function(a){if(!c.isArray(a)||c.isEmpty(a))throw new Error("$and/$or/$nor must be nonempty array");var b=c.map(a,e.DataSelector.compileDocSelector);return function(a){return c.all(b,function(b){return!b(a)})}},$where:function(a){if(!c.isFunction(a)){var b=a;a=function(){return b}}return function(b){return a.call(b)}}},VALUE_OPERATORS:{$in:function(a){if(!c.isArray(a))throw new Error("Argument to $in must be array");return function(b){return e.DataSelector._anyIfArrayPlus(b,function(b){return c.any(a,function(a){return e.DataSelector._equal(a,b)})})}},$all:function(a){if(!c.isArray(a))throw new Error("Argument to $all must be array");return function(b){return c.isArray(b)?c.all(a,function(a){return c.any(b,function(b){return e.DataSelector._equal(a,b)})}):!1}},$lt:function(a){return function(b){return e.DataSelector._anyIfArray(b,function(b){return e.DataSelector._cmp(b,a)<0})}},$lte:function(a){return function(b){return e.DataSelector._anyIfArray(b,function(b){return e.DataSelector._cmp(b,a)<=0})}},$gt:function(a){return function(b){return e.DataSelector._anyIfArray(b,function(b){return e.DataSelector._cmp(b,a)>0})}},$gte:function(a){return function(b){return e.DataSelector._anyIfArray(b,function(b){return e.DataSelector._cmp(b,a)>=0})}},$ne:function(a){return function(b){return!e.DataSelector._anyIfArrayPlus(b,function(b){return e.DataSelector._equal(b,a)})}},$nin:function(a){if(!c.isArray(a))throw new Error("Argument to $nin must be array");var b=this.VALUE_OPERATORS.$in(a);return function(a){return void 0===a?!0:!b(a)}},$exists:function(a){return function(b){return a===(void 0!==b)}},$mod:function(a){var b=a[0],c=a[1];return function(a){return e.DataSelector._anyIfArray(a,function(a){return a%b===c})}},$size:function(a){return function(b){return c.isArray(b)&&a===b.length}},$type:function(a){return function(b){return c.isUndefined(b)?!1:e.DataSelector._anyIfArray(b,function(b){return e.Field.prototype.detectType(b)===a})}},$regex:function(a,b){if(c.isUndefined(b)){if(/[^gim]/.test(b))throw new Error("Only the i, m, and g regexp options are supported");var d=c.isRegExp(a)?a.source:a;a=new RegExp(d,b)}else c.isRegExp(a)||(a=new RegExp(a));return function(b){return c.isUndefined(b)?!1:e.DataSelector._anyIfArray(b,function(b){return a.test(b)})}},$options:function(){return function(){return!0}},$elemMatch:function(a){var b=e.DataSelector.compileDocSelector(a);return function(a){return c.isArray(a)?c.any(a,function(a){return b(a)}):!1}},$not:function(a){var b=e.DataSelector.compileDocSelector(a);return function(a){return!b(a)}}},compileSort:function(a){var b=[];if(c.isArray(a))for(var d=0;d<a.length;d++)"string"==typeof a[d]?b.push({lookup:this._makeLookupFunction(a[d]),ascending:!0}):b.push({lookup:this._makeLookupFunction(a[d][0]),ascending:"desc"!==a[d][1]});else{if("object"!=typeof a)throw new Error("Bad sort specification: ",JSON.stringify(a));for(var f in a)b.push({lookup:this._makeLookupFunction(f),ascending:a[f]>=0})}if(0===b.length)return function(){return 0};var g=function(a,b){var d,f=!0;return c.each(a,function(a){c.isArray(a)||(a=[a]),c.isArray(a)&&0===a.length&&(a=[void 0]),c.each(a,function(a){if(f)d=a,f=!1;else{var c=e.DataSelector._cmp(d,a);(b&&c>0||!b&&0>c)&&(d=a)}})}),d};return function(a,c){a=a.attributes?a.attributes:a,c=c.attributes?c.attributes:c;for(var d=0;d<b.length;++d){var f=b[d],h=g(f.lookup(a),f.ascending),i=g(f.lookup(c),f.ascending),j=e.DataSelector._cmp(h,i);if(0!==j)return f.ascending?j:-j}return 0}}}),e.SqlSelector=e.DataSelector.design({_type:"M.SqlSelector",_selector:null,_query:null,_entity:null,create:function(a,b){var c=this.extend({_entity:b,_selector:null,_query:null});return c.init(a),c},init:function(a){this._selector=this.compileSelector(a),this._query=this.buildSqlQuery(a)},buildStatement:function(){return this._query},buildSqlQuery:function(a){if(a instanceof Function)return"";if(c.isString(a))return a;if(!a||"_id"in a&&!a._id)return"1=2";if(c.isBoolean(a)||c.isArray(a)||e.DataField.isBinary(a))throw new Error("Invalid selector: "+a);return this.buildSqlWhere(a)()},buildSqlWhere:function(a){var b=this,d=[];return c.each(a,function(a,e){if("$"===e.substr(0,1))d.push(b.buildLogicalOperator(e,a));else{var f=b.buildLookup(e),g=b.buildValueSelector(a);c.isFunction(g)&&d.push(function(){return g(f)})}}),function(){var a="";return c.each(d,function(d){c.isFunction(d)&&(a+=d.call(b))}),a}},buildValueSelector:function(a){var b=this;if(null===a)return function(a){return a+" IS NULL"};if(!c.isObject(a))return function(c){return c+" = "+b.buildValue(a)};if(c.isRegExp(a)){var d=a.toString(),e=d.match(/\/[\^]?([^^.*$'+()]*)[\$]?\//);if(e&&e.length>1){var f=d.indexOf("/^")<0?"%":"",g=d.indexOf("$/")<0?"%":"";return function(a){return a+' LIKE "'+f+e[1]+g+'"'}}return null}if(c.isArray(a))return null;if(this.hasOperators(a)){var h=[];return c.each(a,function(a,d){if(!c.has(b.VALUE_OPERATORS,d))throw new Error("Unrecognized operator: "+d);h.push(b.VALUE_OPERATORS[d](a,b))}),function(a){return b.LOGICAL_OPERATORS.$and(h,a)}}return function(c){return c+" = "+b.buildValue(a)}},buildLookup:function(a){var b=this._entity?this._entity.getField(a):null;return a=b&&b.name?b.name:a,'"'+a+'"'},buildValue:function(a){return c.isString(a)?'"'+a.replace(/"/g,'""')+'"':a},buildLogicalOperator:function(a,b){if(c.has(this.LOGICAL_OPERATORS,a)){if(!c.isArray(b)||c.isEmpty(b))throw new Error("$and/$or/$nor must be nonempty array");var d=c.map(b,this.buildSqlWhere,this),e=this;return function(b){return e.LOGICAL_OPERATORS[a](d,b)}}throw new Error("Unrecognized logical operator: "+a)},LOGICAL_OPERATORS:{$and:function(a,b){var d="",e=0;return c.each(a,function(a){var c=null!==a?a(b):"";c&&(e++,d+=d?" AND "+c:c)}),e>1?"( "+d+" )":d},$or:function(a,b){var d="",e=!1;return c.each(a,function(a){var c=null!==a?a(b):"";e|=!c,d+=d&&c?" OR "+c:c}),e?"":"( "+d+" )"},$nor:function(a,b){var d="",e=!1;return c.each(a,function(a){var c=null!==a?a(b):"";e|=!c,d+=d&&c?" OR "+c:c}),e?"":"NOT ( "+d+" )"}},VALUE_OPERATORS:{$in:function(){return null},$all:function(){return null},$lt:function(a,b){return function(c){return c+" < "+b.buildValue(a)}},$lte:function(a,b){return function(c){return c+" <= "+b.buildValue(a)}},$gt:function(a,b){return function(c){return c+" > "+b.buildValue(a)}},$gte:function(a,b){return function(c){return c+"">""+b.buildValue(a)}},$ne:function(a,b){return function(c){return c+" <> "+b.buildValue(a)}},$nin:function(){return null},$exists:function(){return function(a){return a+" IS NOT NULL"}},$mod:function(){return null},$size:function(){return null},$type:function(){return null},$regex:function(){return null},$options:function(){return null},$elemMatch:function(){return null},$not:function(a,b){var c=b.buildSqlWhere(a);return function(a){return"NOT ("+c(a)+")"}}}}),e.Store=function(){this.initialize.apply(this,arguments)},e.Store.extend=e.extend,e.Store.create=e.create,e.Store.design=e.design,c.extend(e.Store.prototype,b.Events,e.Object,{_type:"M.Store",entities:null,options:null,name:"",typeMapping:function(){var a={};return a[e.CONST.TYPE.OBJECTID]=e.CONST.TYPE.STRING,a[e.CONST.TYPE.DATE]=e.CONST.TYPE.STRING,a[e.CONST.TYPE.BINARY]=e.CONST.TYPE.TEXT,a}(),initialize:function(a){a=a||{},this.options=this.options||{},this.options.name=this.name,this.options.typeMapping=this.typeMapping,this.options.entities=this.entities,c.extend(this.options,a||{}),this._setEntities(a.entities||{})},_setEntities:function(a){this.entities={};for(var b in a){var c=e.Entity.from(a[b],{store:this,typeMapping:this.options.typeMapping});c.name=c.name||b;var d=c.collection||e.Collection.extend({model:e.Model.extend({})}),f=d.prototype.model;d.prototype.entity=f.prototype.entity=b,d.prototype.store=f.prototype.store=this,c.idAttribute=c.idAttribute||f.prototype.idAttribute,this.entities[b]=c}},getEntity:function(a){if(a){var b=a.entity||a,d=c.isString(b)?b:b.name;if(d)return this.entities[d]||(b&&b.name?b:{name:d})}},getCollection:function(a){return c.isString(a)&&(a=this.entities[a]),a&&a.collection?e.Collection.prototype.isPrototypeOf(a.collection)?a.collection:new a.collection:void 0},createModel:function(a,b){if(c.isString(a)&&(a=this.entities[a]),a&&a.collection){var d=a.collection.model||a.collection.prototype.model;if(d)return new d(b)}},getArray:function(a){return c.isArray(a)?a:e.isCollection(a)?a.models:c.isObject(a)?[a]:[]},getDataArray:function(a){var d=[];if(c.isArray(a)||b.Collection.prototype.isPrototypeOf(a))c.each(a,function(a){var b=this.getAttributes(a);b&&d.push(b)});else{var e=this.getAttributes(a);e&&d.push(this.getAttributes(e))}return d},getAttributes:function(a){return b.Model.prototype.isPrototypeOf(a)?a.attributes:c.isObject(a)?a:null},initModel:function(){},initCollection:function(){},initEntity:function(){},sync:function(){},fetch:function(a,b){if(!a||a.models||a.attributes||b||(b=a),a&&(a.models||a.attributes)||!b||!b.entity||(a=this.getCollection(b.entity)),a&&a.fetch){var d=c.extend({},b||{},{store:this});a.fetch(d)}},create:function(a,b,d){if(!a||a.models||d||(b=a,d=b),a&&a.models||!d||!d.entity||(a=this.getCollection(d.entity)),a&&a.create){var e=c.extend({},d||{},{store:this});a.create(b,e)}},save:function(a,b,d){if(!a||a.attributes||d||(b=a,d=b),a&&a.attributes||!d||!d.entity||(a=this.createModel(d.entity)),a&&a.save){var e=c.extend({},d||{},{store:this});a.save(b,e)}},destroy:function(a,b){if(a&&a.destroy){var d=c.extend({},b||{},{store:this});a.destroy(d)}},_checkEntity:function(a,b){if(!e.isEntity(b)){var c="No valid entity passed.";return e.Logger.error(e.CONST.ERROR.VALIDATION_PRESENCE,c),this.handleCallback(a.error,c),this.handleCallback(a.finish,c),!1}return!0},_checkData:function(a,b){if(!(c.isArray(b)&&0!==b.length||c.isObject(b))){var d="No data passed.";return e.Logger.error(e.CONST.ERROR.VALIDATION_PRESENCE,d),this.handleCallback(a.error,d),this.handleCallback(a.finish,d),!1}return!0},handleSuccess:function(a){var b=Array.prototype.slice.call(arguments,1);a.success&&this.handleCallback.apply(this,[a.success].concat(b)),a.finish&&this.handleCallback.apply(this,[a.finish].concat(b))},handleError:function(a){var b=Array.prototype.slice.call(arguments,1);a.error&&this.handleCallback.apply(this,[a.error].concat(b)),a.finish&&this.handleCallback.apply(this,[a.finish].concat(b))},CONST:{ERROR_NO_ENTITY:"No valid entity specified",ERROR_LOAD_DATA:"Error while loading data from store",ERROR_SAVE_DATA:"Error while saving data to the store",ERROR_LOAD_IDS:"Error while loading ids from store",ERROR_SAVE_IDS:"Error while saving ids to the store"}}),e.LocalStorageStore=e.Store.extend({_type:"M.LocalStorageStore",ids:{},sync:function(a,b,d){d=d||{};var f,g=d.store||this.store,h=g.getEntity(b.entity||d.entity||this.entity);if(g&&h&&b){var i=b.id||("create"===a?(new e.ObjectID).toHexString():null);switch(f=d.attrs||b.toJSON(d),a){case"patch":case"update":case"create":"create"!==a&&(f=c.extend(g._getItem(h,i)||{},f)),b.id!==i&&b.idAttribute&&(f[b.idAttribute]=i),g._setItem(h,i,f);break;case"delete":g._removeItem(h,i);break;case"read":if(i)f=g._getItem(h,i);else{f=[];var j=g._getItemIds(h);for(i in j){var k=g._getItem(h,i);k&&f.push(k)}}break;default:return}}f?g.handleSuccess(d,f):g.handleError(d,e.Store.CONST.ERROR_NO_ENTITY)},drop:function(a){var b=this.getEntity(a);if(b&&b.name){for(var c=this._findAllKeys(b),d=0;d<c.length;d++)localStorage.removeItem(c[d]);localStorage.removeItem("__ids__"+b.name),this.handleSuccess(a)}else this.handleError(a,e.Store.CONST.ERROR_NO_ENTITY)},_getKey:function(a,b){return"_"+a.name+"_"+b},_getItem:function(a,b){var c;if(a&&b)try{c=JSON.parse(localStorage.getItem(this._getKey(a,b))),c?a.setId(c,b):this._delItemId(b)}catch(d){e.Logger.error(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,e.Store.CONST.ERROR_LOAD_DATA,d)}return c},_setItem:function(a,b,c){if(a&&b&&c)try{localStorage.setItem(this._getKey(a,b),JSON.stringify(c)),this._addItemId(a,b)}catch(d){e.Logger.error(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,e.Store.CONST.ERROR_SAVE_DATA,d)}},_removeItem:function(a,b){a&&b&&(localStorage.removeItem(this._getKey(a,b)),this._delItemId(a,b))},_addItemId:function(a,b){var c=this._getItemIds(a);b in c||(c[b]="",this._saveItemIds(a,c))},_delItemId:function(a,b){var c=this._getItemIds(a);b in c&&(delete c[b],this._saveItemIds(a,c))},_findAllKeys:function(a){var b=[],c=this._getKey(a,"");if(c)for(var d,e=localStorage.length,f=0;e>f;f++)d=localStorage.key(f),d&&d===c&&b.push(d);return b},_getItemIds:function(a){try{var b="__ids__"+a.name;return this.ids[a.name]||(this.ids[a.name]=JSON.parse(localStorage.getItem(b))||{}),this.ids[a.name]}catch(c){e.Logger.error(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,e.Store.CONST.ERROR_LOAD_IDS,c)}},_saveItemIds:function(a,b){try{var c="__ids__"+a.name;localStorage.setItem(c,JSON.stringify(b))}catch(d){e.Logger.error(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,e.Store.CONST.ERROR_SAVE_IDS,d)}}}),e.WebSqlStore=e.Store.extend({_type:"M.WebSqlStore",_selector:null,options:null,name:"themproject",size:1048576,version:"1.0",db:null,dataField:{name:"data",type:"text",required:!0},idField:{name:"id",type:"string",required:!0},typeMapping:function(){var a={};return a[e.CONST.TYPE.OBJECTID]=e.CONST.TYPE.STRING,a[e.CONST.TYPE.DATE]=e.CONST.TYPE.STRING,a[e.CONST.TYPE.OBJECT]=e.CONST.TYPE.TEXT,a[e.CONST.TYPE.ARRAY]=e.CONST.TYPE.TEXT,a[e.CONST.TYPE.BINARY]=e.CONST.TYPE.TEXT,a}(),sqlTypeMapping:function(){var a={};return a[e.CONST.TYPE.STRING]="varchar(255)",a[e.CONST.TYPE.TEXT]="text",a[e.CONST.TYPE.OBJECT]="text",a[e.CONST.TYPE.ARRAY]="text",a[e.CONST.TYPE.FLOAT]="float",a[e.CONST.TYPE.INTEGER]="integer",a[e.CONST.TYPE.DATE]="varchar(255)",a[e.CONST.TYPE.BOOLEAN]="boolean",a}(),initialize:function(a){e.Store.prototype.initialize.apply(this,arguments),this.options=this.options||{},this.options.name=this.name,this.options.size=this.size,this.options.version=this.version,this.options.typeMapping=this.typeMapping,this.options.sqlTypeMapping=this.sqlTypeMapping,c.extend(this.options,a||{}),this._openDb({error:function(a){e.Logger.error(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,a)}})},sync:function(a,b,c){var d=c.store||this.store,f=e.isCollection(b)?b.models:[b];switch(c.entity=c.entity||this.entity,a){case"create":d._checkTable(c,function(){d._insertOrReplace(f,c)});break;case"update":case"patch":d._checkTable(c,function(){d._insertOrReplace(f,c)});break;case"delete":d._delete(f,c);break;case"read":d._select(this,c)}},select:function(a){this._select(null,a)},drop:function(a){this._dropTable(a)},createTable:function(a){this._createTable(a)},execute:function(a){this._executeSql(a)},_openDb:function(a){var b,c;if(!this.db)try{if(window.openDatabase){if(this.db=window.openDatabase(this.options.name,"","",this.options.size),this.entities)for(var d in this.entities)this._createTable({entity:this.entities[d]})}else b="Your browser does not support WebSQL databases."}catch(e){c=e}this.db?this.options.version&&this.db.version!==this.options.version?this._updateDb(a):this.handleSuccess(a,this.db):2===c||"2"===c?this._updateDb(a):(!b&&c&&(b=c),this.handleSuccess(a,b))},_updateDb:function(a){var b,d,f=this;try{var g=window.openDatabase(this.options.name,"","",this.options.size);try{var h=this._sqlUpdateDatabase(g.version,this.options.version);g.changeVersion(g.version,this.options.version,function(a){c.each(h,function(b){e.Logger.log(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,"SQL-Statement: "+b),d=b,a.executeSql(b)})},function(b){f.handleError(a,b,d)},function(){f.handleSuccess(a)})}catch(i){b=i.message,e.Logger.error(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,"changeversion failed, DB-Version: "+g.version)}}catch(i){b=i.message}b&&this.handleError(a,b)},_sqlUpdateDatabase:function(){var a=[];if(this.entities)for(var b in this.entities){var c=this.entities[b];a.push(this._sqlDropTable(c.name)),a.push(this._sqlCreateTable(c))}return a},_sqlDropTable:function(a){return"DROP TABLE IF EXISTS '"+a+"'"},_isAutoincrementKey:function(a,b){if(a&&b){var c=this.getField(a,b);return c&&c.type===e.CONST.TYPE.INTEGER}},_sqlPrimaryKey:function(a,b){return b&&1===b.length?this._isAutoincrementKey(a,b[0])?b[0]+" INTEGER PRIMARY KEY ASC AUTOINCREMENT UNIQUE":b[0]+" PRIMARY KEY ASC UNIQUE":""},_sqlConstraint:function(a,b){return b&&b.length>1?"PRIMARY KEY ("+b.join(",")+") ON CONFLICT REPLACE":""},_sqlCreateTable:function(a){var b=this,d=a.getKeys(),e=1===d.length?this._sqlPrimaryKey(a,d):"",f=d.length>1?this._sqlConstraint(a,d):a.constraint||"",g="",h=this.getFields(a);c.each(h,function(a){if(!e||a.name!==d[0]){var c=b._dbAttribute(a);c&&(g+=(g?", ":"")+c)}}),g||(g=this._dbAttribute(this.dataField));var i="CREATE TABLE IF NOT EXISTS '"+a.name+"' (";return i+=e?e+", ":"",i+=g,i+=f?", "+f:"",i+=");"},_sqlDelete:function(a,b){var c="DELETE FROM '"+b.name+"'",d=this._sqlWhere(a,b)||this._sqlWhereFromData(a,b);return d&&(c+=" WHERE "+d),c+=a.and?" AND "+a.and:""},_sqlWhere:function(a,b){this._selector=null;var d="";return c.isString(a.where)?d=a.where:c.isObject(a.where)&&(this._selector=e.SqlSelector.create(a.where,b),d=this._selector.buildStatement()),d},_sqlWhereFromData:function(a,b){var d=this,e=[];if(a&&a.models&&b&&b.idAttribute){var f,g=b.idAttribute,h=this.getField(b,g);if(c.each(a.models,function(a){f=a.id,c.isUndefined(f)||e.push(d._sqlValue(f,h))}),e.length>0)return g+" IN ("+e.join(",")+")"}return""},_sqlSelect:function(a,b){var c="SELECT ";a.fields?a.fields.length>1?c+=a.fields.join(", "):1===a.fields.length&&(c+=a.fields[0]):c+="*",c+=" FROM '"+b.name+"'",a.join&&(c+=" JOIN "+a.join),a.leftJoin&&(c+=" LEFT JOIN "+a.leftJoin);var d=this._sqlWhere(a,b)||this._sqlWhereFromData(a,b);return d&&(c+=" WHERE "+d),a.order&&(c+=" ORDER BY "+a.order),a.limit&&(c+=" LIMIT "+a.limit),a.offset&&(c+=" OFFSET "+a.offset),c},_sqlValue:function(a,b){var c=b&&b.type?b.type:e.Field.prototype.detectType(a);return c===e.CONST.TYPE.INTEGER||c===e.CONST.TYPE.FLOAT?a:c===e.CONST.TYPE.BOOLEAN?a?"1":"0":c===e.CONST.TYPE.NULL?"NULL":(a=e.Field.prototype.transform(a,e.CONST.TYPE.STRING),a=a.replace(/"/g,'""'),'"'+a+'"')},_dbAttribute:function(a){if(a&&a.name){var b=this.options.sqlTypeMapping[a.type],c=a.required?" NOT NULL":"";if(b)return a.name+" "+b.toUpperCase()+c}},_dropTable:function(a){var b=this.getEntity(a);if(b.db=null,this._checkDb(a)&&b){var c=this._sqlDropTable(b.name);this._executeTransaction(a,[c])}},_createTable:function(a){var b=this.getEntity(a);if(b.db=this.db,this._checkDb(a)&&this._checkEntity(a,b)){var c=this._sqlCreateTable(b);this._executeTransaction(a,[c])}},_checkTable:function(a,b){var c=this.getEntity(a);c&&!c.db?this._createTable({success:function(){b()},error:function(b){this.handleError(a,b)},entity:c}):b()},_insertOrReplace:function(a,b){var d=this.getEntity(b);if(this._checkDb(b)&&this._checkEntity(b,d)&&this._checkData(b,a)){for(var f=this._isAutoincrementKey(d,d.getKey()),g=[],h="INSERT OR REPLACE INTO '"+d.name+"' (",i=0;i<a.length;i++){var j=a[i],k="";f||j.id||!j.idAttribute||j.set(j.idAttribute,(new e.ObjectID).toHexString());var l,m,n=b.attrs||j.toJSON();if(c.isEmpty(d.fields)?(l=[j.id,JSON.stringify(n)],m=["id","data"]):(l=c.values(n),m=c.keys(n)),l.length>0){var o=new Array(l.length).join("?,")+"?",p="'"+m.join("','")+"'";k+=h+p+") VALUES ("+o+");",g.push({statement:k,arguments:l})}}this._executeTransaction(b,g)}},_select:function(a,b){var d=this.getEntity(b);if(this._checkDb(b)&&this._checkEntity(b,d)){var f,g=e.isCollection(a);g?a=[]:b.models=[a];var h=this._sqlSelect(b,d),i=this;this.db.readTransaction(function(b){var j=h.statement||h,k=h.arguments;f=j,e.Logger.log(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,"SQL-Statement: "+j),k&&e.Logger.log(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,"    Arguments: "+JSON.stringify(k)),b.executeSql(j,k,function(b,e){for(var f=e.rows.length,h=0;f>h;h++){var j,k=e.rows.item(h);if(c.isEmpty(d.fields)&&i._hasDefaultFields(k))try{j=JSON.parse(k.data)}catch(l){}else j=k;if(j&&(!i._selector||i._selector.matches(j))){if(!g){a=j;break}a.push(j)}}},function(){})},function(a){e.Logger.error(e.CONST.ERROR.WEBSQL_SYNTAX,"WebSql Syntax Error: "+a.message),i.handleError(b,a.message,f)},function(){i.handleSuccess(b,a)})}},_delete:function(a,b){var c=this.getEntity(b);if(this._checkDb(b)&&this._checkEntity(b,c)){b.models=a;var d=this._sqlDelete(b,c);this._executeTransaction(b,[d])}},_executeSql:function(a){a.sql&&this._executeTransaction(a,[a.sql])},_executeTransaction:function(a,b){var d,f;if(this._checkDb(a)){var g=this;try{this.db.transaction(function(a){c.each(b,function(b){var c=b.statement||b,d=b.arguments;f=c,e.Logger.log(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,"SQL-Statement: "+c),d&&e.Logger.log(e.CONST.LOGGER.TAG_FRAMEWORK_DATA,"    Arguments: "+JSON.stringify(d)),a.executeSql(c,d)})},function(b){e.Logger.error(e.CONST.ERROR.WEBSQL_SYNTAX,b.message),g.handleError(a,b.message,f)},function(){g.handleSuccess(a)})}catch(h){e.Logger.error(e.CONST.ERROR.WEBSQL_UNKNOWN,h.message)}}d&&this.handleCallback(a.error,d,f)},_hasDefaultFields:function(a){return c.every(c.keys(a),function(a){return a===this.idField.name||a===this.dataField.name},this)},_checkDb:function(a){if(!this.db){var b="db handler not initialized.";return e.Logger.error(e.CONST.ERROR.WEBSQL_NO_DBHANDLER,b),this.handleError(a,b),!1}return!0},getFields:function(a){if(c.isEmpty(a.fields)){var b={};b.data=this.dataField;var d=a.idAttribute||"id";return b[d]=this.idField,b}return a.fields},getField:function(a,b){return this.getFields(a)[b]}}),e.BikiniStore=e.Store.extend({_type:"M.BikiniStore",_selector:null,endpoints:{},options:null,localStore:e.WebSqlStore,useLocalStore:YES,useSocketNotify:YES,useOfflineChanges:YES,isConnected:NO,typeMapping:{binary:"text",date:"string"},initialize:function(a){e.Store.prototype.initialize.apply(this,arguments),this.options=this.options||{},this.options.useLocalStore=this.useLocalStore,this.options.useSocketNotify=this.useSocketNotify,this.options.useOfflineChanges=this.useOfflineChanges,this.options.socketPath=this.socketPath,this.options.localStore=this.localStore,this.options.typeMapping=this.typeMapping,this.options.useSocketNotify&&"object"!=typeof io&&(console.log("Socket.IO not present !!"),this.options.useSocketNotify=NO),c.extend(this.options,a||{})},initModel:function(){},initCollection:function(a){var b=a.getUrlRoot(),c=this.getEntity(a.entity);if(b&&c){var d=c.name,f=this._hashCode(b),g=c.credentials||a.credentials,h=g&&g.username?g.username:"",i=d+h+f;a.channel=i;var j=this,k=this.endpoints[f];if(!k){var l=e.Request.getLocation(b);k={},k.baseUrl=b,k.readUrl=a.getUrl(),k.host=l.protocol+"//"+l.host,k.path=l.pathname,k.entity=c,k.channel=i,k.credentials=g,k.socketPath=this.options.socketPath,k.localStore=this.createLocalStore(k),k.messages=this.createMsgCollection(k),k.socket=this.createSocket(k),k.info=this.fetchServerInfo(k),j.endpoints[f]=k}a.endpoint=k,a.listenTo(this,k.channel,this.onMessage,a)}},getEndpoint:function(a){if(a){var b=this._hashCode(a);return this.endpoints[b]}},createLocalStore:function(a,b){if(this.options.useLocalStore&&a){var c={};return c[a.entity.name]={name:a.channel,idAttribute:b},this.options.localStore.create({entities:c})}},createMsgCollection:function(a){if(this.options.useOfflineChanges&&a){var b=e.Collection.design({url:a.url,entity:"msg-"+a.channel,store:this.options.localStore.create()}),c=this;return b.fetch({success:function(){c.sendMessages(a)}}),b}},createSocket:function(a,b){if(this.options.useSocketNotify&&a.socketPath&&a){var c=this,d=a.host,e=a.path;e=a.socketPath||e+("/"===e.charAt(e.length-1)?"":"/")+"live";var f=e&&0===e.indexOf("/")?e.substr(1):e;return a.socket=io.connect(d,{resource:f}),a.socket.on("connect",function(){c._bindChannel(a,b),c.onConnect(a)}),a.socket.on("disconnect",function(){console.log("socket.io: disconnect"),c.onDisconnect(a)}),a.socket}},_bindChannel:function(a,b){var c=this;if(a&&a.socket){var d=a.channel,e=a.socket,f=this.getLastMessageTime(d);b=b||a.entity.name,e.on(d,function(a){a&&(c.trigger(d,a),c.options.useLocalStore&&c.setLastMessageTime(d,a.time))}),e.emit("bind",{entity:b,channel:d,time:f})}},getLastMessageTime:function(a){return localStorage.getItem("__"+a+"last_msg_time")||0},setLastMessageTime:function(a,b){b&&localStorage.setItem("__"+a+"last_msg_time",b)},_hashCode:function(a){var b,c=0;if(0===a.length)return c;for(var d=0,e=a.length;e>d;d++)b=a.charCodeAt(d),c=(c<<5)-c+b,c|=0;return c},onConnect:function(a){this.isConnected=YES,this.fetchChanges(a),this.sendMessages(a)},onDisconnect:function(a){this.isConnected=NO,a.socket&&a.socket.socket&&a.socket.socket.onDisconnect()},onMessage:function(a){if(a&&a.method){var b=this.endpoint?this.endpoint.localStore:null,c={store:b,entity:this.entity,merge:YES,fromMessage:YES,parse:YES},d=a.data;switch(a.method){case"patch":case"update":case"create":c.patch="patch"===a.method;var e=a.id?this.get(a.id):null;e?e.save(d,c):this.create(d,c);break;case"delete":if(a.id)if("all"===a.id){for(;e=this.first();)b&&b.sync.apply(this,["delete",e,{store:b,fromMessage:YES}]),this.remove(e);this.store.setLastMessageTime(this.endpoint.channel,"")}else{var f=this.get(a.id);f&&f.destroy(c)}}}},sync:function(a,b,c){var d=c.store||this.store;if(c.fromMessage)return d.handleCallback(c.success);var f=d.getEndpoint(this.getUrlRoot());if(d&&f){var g=this.channel;e.isModel(b)&&!b.id&&b.set(b.idAttribute,(new e.ObjectID).toHexString());var h=d.getLastMessageTime(g);"read"===a&&f.localStore&&h?"read"===a&&d.fetchChanges(f):d.addMessage(a,b,f.localStore?{}:c,f),f.localStore&&(c.store=f.localStore,f.localStore.sync.apply(this,arguments))}},addMessage:function(a,b,d,e){var f=this;if(a&&b){var g=b.changedSinceSync,h=null,i=YES;switch(a){case"update":case"create":h=d.attrs||b.toJSON();break;case"patch":if(c.isEmpty(g))return;h=b.toJSON({attrs:g});break;case"delete":break;default:i=NO}var j={_id:b.id,id:b.id,method:a,data:h},k=function(a,c){f.emitMessage(a,c,d,b)};i?this.storeMessage(e,j,k):k(e,j)}},emitMessage:function(a,b,d,f){var g=a.channel,h=this,i=e.isModel(f)||"read"!==b.method?a.baseUrl:a.readUrl;b.id&&"create"!==b.method&&(i+="/"+b.id),f.sync.apply(f,[b.method,f,{url:i,error:function(c,e){!c.responseText&&h.options.useOfflineChanges?(h.onDisconnect(a),h.handleCallback(d.success,b.data)):h.removeMessage(a,b,function(){h.handleCallback(d.error,e)})},success:function(e){h.isConnected||h.onConnect(a),h.removeMessage(a,b,function(a,b){if(d.success){var f=e;h.handleCallback(d.success,f)}else if("read"===b.method)for(var i=c.isArray(e)?e:[e],j=0;j<i.length;j++)e=i[j],e&&h.trigger(g,{id:e._id,method:"update",data:e});else h.trigger(g,b)})},store:{}}])},fetchChanges:function(a){var b=this,c=a?a.channel:"",d=b.getLastMessageTime(c);if(a&&a.baseUrl&&c&&d){var f=new e.Collection({});f.fetch({url:a.baseUrl+"/changes/"+d,success:function(){f.each(function(a){a.time&&a.method&&(b.options.useLocalStore&&b.setLastMessageTime(c,a.time),b.trigger(c,a))})},credentials:a.credentials})}},fetchServerInfo:function(a){var b=this;if(a&&a.baseUrl){var c=new e.Model,d=b.getLastMessageTime(a.channel);
c.fetch({url:a.baseUrl+"/info",success:function(){if(!d&&c.get("time")&&b.setLastMessageTime(a.channel,c.get("time")),!a.socketPath&&c.get("socketPath")){a.socketPath=c.get("socketPath");var e=c.get("entity")||a.entity.name;b.options.useSocketNotify&&b.createSocket(a,e)}},credentials:a.credentials})}},sendMessages:function(a){if(a&&a.messages){var b=this;a.messages.each(function(c){var d;try{d=JSON.parse(c.get("msg"))}catch(e){}var f=c.get("channel");if(d&&f){var g=b.createModel({collection:a.messages},d.data);b.emitMessage(a,d,{},g)}else c.destroy()})}},mergeMessages:function(a){return a},storeMessage:function(a,b,d){if(a&&a.messages&&b){var e=a.channel,f=a.messages.get(b._id);if(f){var g=JSON.parse(f.get("msg"));f.save({msg:JSON.stringify(c.extend(g,b))})}else a.messages.create({_id:b._id,id:b.id,msg:JSON.stringify(b),channel:e})}d(a,b)},removeMessage:function(a,b,c){if(a&&a.messages){var d=a.messages.get(b._id);d&&d.destroy()}c(a,b)},clear:function(a){if(a){var b=this.getEndpoint(a.getUrlRoot());b&&(b.localStore&&b.localStore.destroy(),b.messages&&b.messages.destroy(),a.reset(),this.setLastMessageTime(b.channel,""))}}}),e.Interface=e.Object.design({_type:"M.Interface",isMInterface:YES,getInterface:function(){return void 0}}),e.ViewEnableState=e.Interface.design({_type:"M.ViewEnableState",_isEnabled:YES,disable:function(){return this._isEnabled=NO,this.$el.addClass("disabled").removeClass("enabled"),this._disableEvents(),this},enable:function(){return this._isEnabled=YES,this.$el.addClass("enabled").removeClass("disabled"),this._enableEvents(),this},getInterface:function(){return{disable:this.disable,enable:this.enable}}}),e.ActiveState=e.Interface.design({_type:"M.ActiveState",_registerActiveState:function(a){if(!a._isInButtonGroup){var b=a._internalEvents||{};b.touchstart=b.touchstart||[],b.touchend=b.touchend||[],b.touchcancel=b.touchcancel||[],b.mousedown=b.touchstart||[],b.mouseup=b.touchend||[],b.touchmove=b.touchmove||[],b.touchleave=b.touchleave||[],b.touchstart=c.isArray(b.touchstart)?b.touchstart:[b.touchstart],b.touchend=c.isArray(b.touchend)?b.touchend:[b.touchend],b.touchcancel=c.isArray(b.touchcancel)?b.touchcancel:[b.touchcancel],b.mousedown=c.isArray(b.mousedown)?b.mousedown:[b.mousedown],b.mouseup=c.isArray(b.mouseup)?b.mouseup:[b.mouseup],b.touchmove=c.isArray(b.touchmove)?b.touchmove:[b.touchmove],b.touchleave=c.isArray(b.touchleave)?b.touchleave:[b.touchleave];var d=function(a,b){b._hammertime.enabled!==NO&&b.$el.addClass("active")},e=function(a,b){b.$el.removeClass("active")},f=function(a,b){b.$el.removeClass("active")};b.touchstart.push(d),b.touchend.push(e),b.touchcancel.push(f),b.mousedown.push(d),b.mouseup.push(e),b.touchmove.push(e),b.touchleave.push(e),a._internalEvents=b}},getInterface:function(a){return{registerActiveState:this._registerActiveState(a)}}}),e.AddCssClass=e.Interface.design({_type:"M.AddCssClass",_addCssClass:function(a){a.classes&&(a._internalCssClasses+=" "+a.classes)},getInterface:function(a){return{registerAddCssClassInterface:this._addCssClass(a)}}}),e.Templates={"default":{"accordion.ejs":"<ul><%= value %></ul>","accordionitem.ejs":"<ul><%= value %></ul>","button.ejs":'<div class="button"><% if(icon) { %> <i class="fa <%= icon %>"></i> <% } %> <div data-binding="value"<% if(value) {  } %>><%= value %></div></div>',"buttongroup.ejs":'<div class="clearfix" data-childviews="buttons"></div>',"checkboxlist.ejs":'<div><%= label %><div data-childviews="checkbox-options"></div></div>',"checkboxoption.ejs":'<label><input type="checkbox" name="<%= name %>" value="<%= value %>"><i class="needsclick fa"></i> <%= label %></label>',"debug.ejs":'<div><div data-childviews="debug-menu"></div><div data-childviews="debug-grid"></div></div>',"dialog.ejs":"<div></div>","image.ejs":'<img src="<%= value %>" alt="<%= alt %>"/>',"label.ejs":'<div contenteditable="true"><%= value %></div>',"list.ejs":'<ul data-childviews="list"></ul>',"listitem.ejs":"<li><%= value %></li>","listitemlinked.ejs":'<li><span><%= value %></span><i class="fa <%= icon %>"></i></li>',"loader.ejs":'<div class="m-view m-overlayview m-loaderview m-loaderview-show" style="display: block;"> <div class="m-view m-overlayview-inner m-loaderview-inner"> <div class="m-view m-labelview m-loaderview-inner-message"></div> <div class="m-view m-loaderview-inner-icon m-loaderview-inner-icon-only"> <div class="m-view m-loaderview-inner-icon-1"></div> <div class="m-view m-loaderview-inner-icon-2"></div> <div class="m-view m-loaderview-inner-icon-3"></div> <div class="m-view m-loaderview-inner-icon-4"></div> <div class="m-view m-loaderview-inner-icon-5"></div> <div class="m-view m-loaderview-inner-icon-6"></div> <div class="m-view m-loaderview-inner-icon-7"></div> <div class="m-view m-loaderview-inner-icon-8"></div> </div> </div> </div>',"menu.ejs":'<div class="movable-backdrop fade"></div><div class="movable-container"><span><%= value %></span><div class="menu-content" data-childviews="menu-content"></div></div>',"modal.ejs":'<div data-childviews="content"><div>',"model.ejs":"<ul><%= value %></ul>","movable.ejs":'<div class="movable-element"><%= value %></div>',"radiolist.ejs":'<div><%= label %><div data-childviews="radio-options"></div></div>',"radiooption.ejs":'<label><input type="radio" name="<%= name %>" value="<%= value %>"><i class="needsclick fa"></i><%= label %></label>',"searchfield.ejs":'<div contenteditable="true"><%= value %></div>',"select.ejs":'<div class="selection-list<% if(isMultiple){ %> multiple<% } %>"><select<% if(isMultiple){ %> multiple<% } %>><%= value %></select></div>',"slider.ejs":'<input type="range">',"tabbarbuttongroup.ejs":"<div></div>","text.ejs":'<div><% if(label) {  %><div class="label"><%= label %></div><% } %><div><% if(icon) {  %><div class="input-icon-addon"><i class="fa <%= icon %> fa-fw"></i><% } %><%= value %></div>',"textarea.ejs":"<div><% if(label) {  %><label><%= label %><% } %><textarea><%= value %></textarea><% if(label) {  %></label><% } %></div>","textfield.ejs":'<div><% if(label) {  %><label><%= label %><% } %><div class="<% if(icon) {  %> input-icon-addon<% } %>"><% if(icon) {  %><i class="fa <%= icon %> fa-fw"></i><% } %><input type="<%= type %>" <% if(placeholder) { %> placeholder="<%= placeholder %>"<% } %> value="<%= value %>"></div><% if(label) {  %></label><% } %></div>',"toast.ejs":'<div class="toast"><div id="<%= id %>"><%= text %></div></div>',"toggle.ejs":'<div><div data-childviews="first"></div><div data-childviews="second"></div></div>',"toggleswitch.ejs":'<div>\n    <div class="toggleswitch-value-listener" contenteditable="true"><%= value %></div>\n\n    <% if(label){%>\n        <div class="label-descr"> <%= label %></div>\n    <% }%>\n    <div class="movable-grid">\n        <div class="movable-container">\n              <% if(onLabel){%>\n                  <div class="on-value"><%= onLabel %></div>\n              <% }%>\n\n              <% if(onLabel){%>\n                  <div class="off-value"><%= offLabel %></div>\n              <% }%>\n\n              <% if(onLabel){%>\n                  <div class="movable-element"></div>\n              <% }%>\n        </div>\n    </div>\n</div>\n\n',"toolbar.ejs":'<div><div data-childviews="first"></div> <div class="center" data-binding="value"><%= value %></div> <div data-childviews="second"></div></div>',"view.ejs":"<div><%= value %></div>"}},e.Animation=e.Object.design({animationSupport:function(){return e.Environment.isLowerThanAndroid4?!1:(e.Environment.isLowerThaniPhone4S,Modernizr.cssanimations)}(),transitionSupport:function(){return Modernizr.csstransitions}(),animationEndEventName:function(){var a={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"};return a[Modernizr.prefixed("animation")]}(),transitionEndEventName:function(){var a={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return a[Modernizr.prefixed("transition")]}()}),e.ThemeVars={_vars:{"default":{blue:"#1092d3",lightblue:"#58b3e0",darkblue:"#0e7cb4",purple:"#6c64ff",lightpurple:"#9893ff",darkpurple:"#5c55d9",green:"#2dcca2",lightgreen:"#6cdbbe",darkgreen:"#26ae8a",red:"#ed253d",lightred:"#f26778",darkred:"#ca1f34",orange:"#f45b42",lightorange:"#f78d7b",darkorange:"#d04d38",yellow:"#eab13a",lightyellow:"#f0c975",darkyellow:"#d99731",grey:"#c3c3c3",lightgrey:"#d5d5d5",darkgrey:"#a6a6a6",black:"#000000",white:"#FFFFFF",darkwhite:"#F2F2F2","debug-1":"#02ccb9","debug-2":"#00cc09","debug-3":"#cc3500","debug-4":"#cc008d","debug-5":"#9f00cc","debug-6":"#4f00cc","debug-7":"#003fcc","debug-8":"#0073cc","grid-columns":"12","grid-gutter-width":"30px",lightenPercentage:"15%",lightenPercentageLight:"5%","m-button-icon-only-width":"50px","m-button-border-width":"1px","m-button-border-color":"#1092d3","m-button-text-color":"#1092d3","m-button-border-radius":"4px","m-button-border-style":"solid","m-button-padding-bottom":"10px","m-button-padding-top":"10px","m-button-padding-left-right":"10px","m-button-padding":"10px 10px 10px 10px","m-button-primary-border-color":"#6c64ff","m-button-primary-text-color":"#6c64ff","m-button-primary-background-color":"#FFFFFF","m-button-success-border-color":"#2dcca2","m-button-success-text-color":"#2dcca2","m-button-success-background-color":"#FFFFFF","m-button-error-border-color":"#ed253d","m-button-error-text-color":"#ed253d","m-button-error-background-color":"#FFFFFF","m-button-warning-border-color":"#f45b42","m-button-warning-text-color":"#f45b42","m-button-warning-background-color":"#FFFFFF","m-button-info-border-color":"#eab13a","m-button-info-text-color":"#eab13a","m-button-info-background-color":"#FFFFFF","m-button-fuzzy-border-color":"#c3c3c3","m-button-fuzzy-text-color":"#c3c3c3","m-button-fuzzy-background-color":"#FFFFFF",strong:"bold",normal:"normal",weak:"lighter","form-border-width":"1px","form-border-color":"#1092d3","form-border-style":"solid","form-element-border":"1px solid #1092d3","textfield-icon-padding":"30px","textfield-icon-x-position":"4px","textfield-icon-y-position":"14px","textfield-icon-font-size":"2.2rem","textfield-padding":"6px","m-primary-color":"#1092d3","m-primary-text-color":"#000000","m-primary-border-color":"#58b3e0","m-primary-active-color":"#0e7cb4","m-primary-active-text-color":"#FFFFFF","tablayout-menu-height":"50px","tablayout-menu-button-padding":"13px 0 0 0","tablayout-menu-scroll-button-width":"200px","switch-header-content-padding":"4px 0 0 0","header-top":"4px","m-header-icon-only-font-size":"2.4rem","m-primary-font-family":'"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif',"m-primary-font-weight":"300","m-primary-font-size":"1.6rem","m-primary-calc-font-size":"16px","m-primary-line-height":"2.2rem","m-primary-font-color":"#000000","m-primary-margin-top":"10px","m-primary-margin-bottom":"20px","modal-backdrop-background-color":"#000000","content-padding":"15px","m-primary-disabled-color":"#d5d5d5","m-primary-disabled-text-color":"#c3c3c3","selection-color":"#c3c3c3","selection-checked-color":"#1092d3","m-list-item-color":"#2dcca2","m-stencil-text-shadow":"rgba(255, 255, 255, 0.5) 0px 3px 3px","m-menu-view-width":"200px","m-menu-view-device-swipe-listener-width":"20px","m-menu-view-transition-width":"200px - 20px","m-menu-transition":"500ms"},android_dark:{"m-primary-color":"#669900","m-primary-border-color":"#669900","m-primary-active-color":"#99CC00"},android_light:{"m-primary-color":"#669900","m-primary-border-color":"#669900","m-primary-active-color":"#99CC00"},ios:{blue:"#59C8FA",lightblue:"#46b8da",darkblue:"#007AFF",green:"#4BD964",red:"#FF3B30",lightred:"#FF2D55",grey:"#8E8E93","m-primary-font-family":'-apple-system-font, "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif',lightenPercentage:"25%","textfield-icon-y-position":"13px","m-primary-active-color":"$lightgrey","m-primary-active-text-color":"#007AFF","tablayout-menu-height":"50px","tablayout-menu-scroll-button-width":"140px","selection-checked-color":"#59C8FA","m-button-padding-bottom":"10px","m-button-padding":"$m-button-padding-top $m-button-padding-left-right 10px $m-button-padding-left-right-top $m-button-padding-top $m-button-padding-left-right 10px $m-button-padding-left-right-left-right 10px $m-button-padding-top $m-button-padding-left-right 10px $m-button-padding-left-right-left-right"}},get:function(a,b){var b=b||e.Environment.device.os,c=this._vars[b]?this._vars[b][a]:!1;return c||b==e.ThemeVars.CONST.DEFAULT||(c=this._vars[e.ThemeVars.CONST.DEFAULT][a]),c||console.log('Can not find varibale "'+a+'".'),c}},e.ThemeVars.CONST={IOS:"ios",ANDROID_DARK:"android_dark",ANDROID_LIGHT:"android_light",ANDROID:"android_dark",DEFAULT:"default"},e.TemplateManager=e.Object.design({_currentUI:"default",get:function(a,b){b=b||e.TemplateManager._currentUI;var c=e.Templates[b][a];return c?c:"default"!==b?this.get(a,"default"):null}}),e.Transitions=e.Object.design({_transition:"",_main:null,_iterate:null,_pages:null,_pagesCount:0,_current:0,_isAnimating:!1,_endCurrPage:!1,_endNextPage:!1,reset:function(){this._transition="",this._main=null,this._iterate=null,this._pages=null,this._pagesCount=0,this._current=0,this._isAnimating=!1,this._endCurrPage=!1,this._endNextPage=!1},init:function(a){return this._main=a?a:d("#m-main"),this._pages=this._main.find("div.m-page"),this._pagesCount=this._pages.length,this._pages.each(function(){var a=d(this);a.data("originalClassList",a.attr("class"))}),this._pages.eq(this._current).addClass("m-page-current"),this},startTransition:function(){if(this._isAnimating||a[e.APPLICATION_NAME]&&a[e.APPLICATION_NAME].isInitialLoad)return!1;this._isAnimating=!0;var b=this._pages.eq(this._current);this._current<this._pagesCount-1?this._current+=1:this._current=0,this._transition||(this._transition=this.getDefaultTransition());var c=this._pages.eq(this._current).addClass("m-page-current");if(!e.Animation.animationSupport||this._transition===e.PageTransitions.CONST.NONE)return this._onEndAnimation(b,c),void 0;var f=this._transition.split("|"),g=f[0],h=f[1],i=this,j=e.Animation.animationEndEventName;d(b[0]).on(j,function(){b.off(j),i._endCurrPage=!0,i._endNextPage&&i._onEndAnimation(b,c)}),d(c[0]).on(j,function(){c.off(j),i._endNextPage=!0,i._endCurrPage&&i._onEndAnimation(b,c)}),setTimeout(function(){c.addClass(h),b.addClass(g)},0)},setTransition:function(a){this._transition=a},getDefaultTransition:function(){return e.PageTransitions.CONST.MOVE_TO_LEFT_FROM_RIGHT},isAnimating:function(){return this._isAnimating},_onEndAnimation:function(a,b){this._endCurrPage=!1,this._endNextPage=!1,this._resetPage(a,b),this._isAnimating=!1},_resetPage:function(a,b){a.attr("class",a.data("originalClassList")),b.attr("class",b.data("originalClassList")+" m-page-current")}}),e.Transitions.CONST={NONE:"none",MOVE_TO_LEFT_FROM_RIGHT:"m-page-moveToLeft|m-page-moveFromRight",MOVE_TO_RIGHT_FROM_LEFT:"m-page-moveToRight|m-page-moveFromLeft",MOVE_TO_TOP_FROM_BOTTOM:"m-page-moveToTop|m-page-moveFromBottom",MOVE_TO_BOTTOM_FROM_TOP:"m-page-moveToBottom|m-page-moveFromTop",FADE_FROM_RIGHT:"m-page-fade|m-page-moveFromRight m-page-ontop",FADE_FROM_LEFT:"m-page-fade|m-page-moveFromLeft m-page-ontop",FADE_FROM_BOTTOM:"m-page-fade|m-page-moveFromBottom m-page-ontop",FADE_FROM_TOP:"m-page-fade|m-page-moveFromTop m-page-ontop",FADE_LEFT_FADE_RIGHT:"m-page-moveToLeftFade|m-page-moveFromRightFade",FADE_RIGHT_FADE_LEFT:"m-page-moveToRightFade|m-page-moveFromLeftFade",FADE_TOP_FADE_BOTTOM:"m-page-moveToTopFade|m-page-moveFromBottomFade",FADE_BOTTOM_FADE_TOP:"m-page-moveToBottomFade|m-page-moveFromTopFade",DIFFERENT_EASING_FROM_RIGHT:"m-page-moveToLeftEasing m-page-ontop|m-page-moveFromRight",DIFFERENT_EASING_FROM_LEFT:"m-page-moveToRightEasing m-page-ontop|m-page-moveFromLeft",DIFFERENT_EASING_FROM_BOTTOM:"m-page-moveToTopEasing m-page-ontop|m-page-moveFromBottom",DIFFERENT_EASING_FROM_TOP:"m-page-moveToBottomEasing m-page-ontop|m-page-moveFromTop",SCALE_DOWN_FROM_RIGHT:"m-page-scaleDown|m-page-moveFromRight m-page-ontop",SCALE_DOWN_FROM_LEFT:"m-page-scaleDown|m-page-moveFromLeft m-page-ontop",SCALE_DOWN_FROM_BOTTOM:"m-page-scaleDown|m-page-moveFromBottom m-page-ontop",SCALE_DOWN_FROM_TOP:"m-page-scaleDown|m-page-moveFromTop m-page-ontop",SCALE_DOWN_SCALE_DOWN:"m-page-scaleDown|m-page-scaleUpDown m-page-delay300",SCALE_UP_SCALE_UP:"m-page-scaleDownUp|m-page-scaleUp m-page-delay300",MOVE_TO_LEFT_SCALE_UP:"m-page-moveToLeft m-page-ontop|m-page-scaleUp",MOVE_TO_RIGHT_SCALE_UP:"m-page-moveToRight m-page-ontop|m-page-scaleUp",MOVE_TO_TOP_SCALE_UP:"m-page-moveToTop m-page-ontop|m-page-scaleUp",MOVE_TO_BOTTOM_SCALE_UP:"m-page-moveToBottom m-page-ontop|m-page-scaleUp",SCALE_DOWN_SCALE_UP:"m-page-scaleDownCenter|m-page-scaleUpCenter m-page-delay400",GLUE_LEFT_FROM_RIGHT:"m-page-rotateRightSideFirst|m-page-moveFromRight m-page-delay200 m-page-ontop",GLUE_RIGHT_FROM_LEFT:"m-page-rotateLeftSideFirst|m-page-moveFromLeft m-page-delay200 m-page-ontop",GLUE_BOTTOM_FROM_TOP:"m-page-rotateTopSideFirst|m-page-moveFromTop m-page-delay200 m-page-ontop",GLUE_TOP_FROM_BOTTOM:"m-page-rotateBottomSideFirst|m-page-moveFromBottom m-page-delay200 m-page-ontop",FLIP_RIGHT:"m-page-flipOutRight|m-page-flipInLeft m-page-delay500",FLIP_LEFT:"m-page-flipOutLeft|m-page-flipInRight m-page-delay500",FLIP_TOP:"m-page-flipOutTop|m-page-flipInBottom m-page-delay500",FLIP_BOTTOM:"m-page-flipOutBottom|m-page-flipInTop m-page-delay500",FALL:"m-page-rotateFall m-page-ontop|m-page-scaleUp",NEWSPAPER:"m-page-rotateOutNewspaper|m-page-rotateInNewspaper m-page-delay500",PUSH_LEFT_FROM_RIGHT:"m-page-rotatePushLeft|m-page-moveFromRight",PUSH_RIGHT_FROM_LEFT:"m-page-rotatePushRight|m-page-moveFromLeft",PUSH_TOP_FROM_BOTTOM:"m-page-rotatePushTop|m-page-moveFromBottom",PUSH_BOTTOM_FROM_TOP:"m-page-rotatePushBottom|m-page-moveFromTop",PUSH_LEFT_PULL_RIGHT:"m-page-rotatePushLeft|m-page-rotatePullRight m-page-delay180",PUSH_RIGHT_PULL_LEFT:"m-page-rotatePushRight|m-page-rotatePullLeft m-page-delay180",PUSH_TOP_PULL_BOTTOM:"m-page-rotatePushTop|m-page-rotatePullBottom m-page-delay180",PUSH_BOTTOM_PULL_TOP:"m-page-rotatePushBottom|m-page-rotatePullTop m-page-delay180",FOLD_LEFT_FROM_RIGHT:"m-page-rotateFoldLeft|m-page-moveFromRightFade",FOLD_RIGHT_FROM_LEFT:"m-page-rotateFoldRight|m-page-moveFromLeftFade",FOLD_TOP_FROM_BOTTOM:"m-page-rotateFoldTop|m-page-moveFromBottomFade",FOLD_BOTTOM_FROM_TOP:"m-page-rotateFoldBottom|m-page-moveFromTopFade",MOVE_TO_RIGHT_UNFOLD_LEFT:"m-page-moveToRightFade|m-page-rotateUnfoldLeft",MOVE_TO_LEFT_UNFOLD_RIGHT:"m-page-moveToLeftFade|m-page-rotateUnfoldRight",MOVE_TO_BOTTOM_UNFOLD_TOP:"m-page-moveToBottomFade|m-page-rotateUnfoldTop",MOVE_TO_TOP_UNFOLD_BOTTOM:"m-page-moveToTopFade|m-page-rotateUnfoldBottom",ROOM_TO_LEFT:"m-page-rotateRoomLeftOut m-page-ontop|m-page-rotateRoomLeftIn",ROOM_TO_RIGHT:"m-page-rotateRoomRightOut m-page-ontop|m-page-rotateRoomRightIn",ROOM_TO_TOP:"m-page-rotateRoomTopOut m-page-ontop|m-page-rotateRoomTopIn",ROOM_TO_BOTTOM:"m-page-rotateRoomBottomOut m-page-ontop|m-page-rotateRoomBottomIn",CUBE_TO_LEFT:"m-page-rotateCubeLeftOut m-page-ontop|m-page-rotateCubeLeftIn",CUBE_TO_RIGHT:"m-page-rotateCubeRightOut m-page-ontop|m-page-rotateCubeRightIn",CUBE_TO_TOP:"m-page-rotateCubeTopOut m-page-ontop|m-page-rotateCubeTopIn",CUBE_TO_BOTTOM:"m-page-rotateCubeBottomOut m-page-ontop|m-page-rotateCubeBottomIn",CAROUSEL_TO_LEFT:"m-page-rotateCarouselLeftOut m-page-ontop|m-page-rotateCarouselLeftIn",CAROUSEL_TO_RIGHT:"m-page-rotateCarouselRightOut m-page-ontop|m-page-rotateCarouselRightIn",CAROUSEL_TO_TOP:"m-page-rotateCarouselTopOut m-page-ontop|m-page-rotateCarouselTopIn",CAROUSEL_TO_BOTTOM:"m-page-rotateCarouselBottomOut m-page-ontop|m-page-rotateCarouselBottomIn",SIDES:"m-page-rotateSidesOut|m-page-rotateSidesIn m-page-delay200",SLIDE:"m-page-rotateSlideOut|m-page-rotateSlideIn"},e.PageTransitions=e.Transitions.design(),function(){e.View=b.View.extend({constructor:function(a){this.cid=c.uniqueId("view"),a=a||{};var b=["scope","model","collection","el","id","attributes","className","tagName","events","scopeKey","binding","computedValue","onSet","onGet","enabled"];c.extend(this,c.pick(a,b)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()}}),e.View.create=e.create,e.View.design=function(a,b,c){return this.extend().create(a,b,c)},e.View.implements=e.implements,c.extend(e.View.prototype,e.Object,{_type:"M.View",template:null,_template:null,_templateString:e.TemplateManager.get("view.ejs"),_templateValues:null,extendTemplate:null,_firstRender:YES,useElement:NO,_hasI18NListener:NO,onSet:null,onGet:null,cssClass:null,_internalCssClasses:"",grid:null,events:null,_events:null,_internalEvents:null,_value:null,_hammertime:null,_parentView:null,scopeKey:null,binding:null,_originalEvents:null,useParentValue:NO,_setModel:function(a){return this.model=a,this},_setCollection:function(a){return this.collection=a,this},_getModel:function(){return this.model},getValue:function(){return this.model?this._value.hasOwnProperty("attribute")&&this._value.hasOwnProperty("model")?this._value.model.get(this._value.attribute):this._getModel().attributes:this._value},_getValue:function(){return this._value},_setValue:function(a){this._value=a},_setChildViewValue:function(a){c.each(this.childViews,function(b){b.useParentValue&&(b._setValue(a),e.isModel(a)&&b._setModel(a))},this)},getPropertyValue:function(a,b){var d=b;return c.each(a.split("."),function(a){d=d[a]?d[a]:e.isModel(d)||e.isCollection(d)?{model:d,attribute:a}:null}),d},initialize:function(a){return this.scopeKey=this.scopeKey||this.binding,this._registerView(),this._addInterfaces(),this._assignValue(a),this._assignTemplateValues(),this._mapEventsToScope(this.scope),this._addInternalEvents(),this._addCustomEvents(this.scope),this.useElement||this._registerEvents(),this._assignContentBinding(),this},_registerView:function(){e.ViewManager.registerView(this)},_assignValue:function(a){this.value||"undefined"!=typeof this.value&&null!==this.value?this._setValue(this.value):this.scopeKey?this._setValue(this.getPropertyValue(this.scopeKey,this.scope)):a&&a.value&&this._setValue(a.value);var b=this._getValue();return b&&(e.isModel(b.model)?this._setModel(b.model):e.isModel(b)?this._setModel(b):e.isCollection(b)&&(this.collection=b)),this._reactOnLocaleChanged()&&(e.I18N.on(e.CONST.I18N.LOCALE_CHANGED,function(){this.render()},this),this._hasI18NListener=YES),this},_reactOnLocaleChanged:function(){return e.isI18NItem(this.value)||e.isI18NItem(this.label)},_assignContentBinding:function(){var a=this,b=this._getValue();return this.scopeKey&&e.isModel(b)?this.listenTo(this.scope,this.scopeKey,function(b){a._setModel(b),a.render()}):this.scopeKey&&e.isCollection(b)?this.listenTo(this.scope,this.scopeKey,function(b){a._setCollection(b),a.render()}):this.scopeKey&&b&&e.isModel(b.model)&&b.attribute&&this.listenTo(this.scope,this.scopeKey.split(".")[0],function(b){a._setModel(b),a.render()}),this},_mapEventsToScope:function(a){var b={};return this.events&&(c.each(this.events,function(d,e){var f=d;"string"==typeof d&&a&&"function"==typeof a[d]&&(f=a[d]),b[e]=c.isArray(f)?f:[f]},this),this._originalEvents=this.events,this.events=null),this._events=b,this},_addInternalEvents:function(){this._internalEvents&&this._addEvents(this._internalEvents)},_addEvents:function(a){c.each(a,function(a,b){this._addEvent(a,b)},this)},_addEvent:function(a,b){var d=c.isArray(a)?a:[a];this._events[b]=c.isArray(this._events[b])?this._events[b]:[],this._events[b]=this._events[b].concat(d)},_addCustomEvents:function(){if(this._events){var a=this,b={enter:{origin:"keyup",callback:function(b){13===b.keyCode&&a._events.enter[0].apply(a.scope,arguments)}}};for(var c in this._events)b.hasOwnProperty(c)&&this._addEvent(b[c].callback,b[c].origin)}},_getEventOptions:function(){var a=!1,b=!0,c=!1;return{prevent_default:a,no_mouseevents:b,stop_browser_behavior:c}},_registerEvents:function(){if(this._events){var a=this;this._eventCallback={},Object.keys(this._events).forEach(function(b){this._hammertime=new Hammer(a.el,a._getEventOptions()),this._eventCallback[b]=function(b){if(a._hammertime.enabled!==NO){var d=Array.prototype.slice.call(arguments);d.push(a),c.each(a._events[b.type],function(b){b.apply(a.scope,d)},a)}},this._hammertime.on(b,this._eventCallback[b])},this)}},_disableEvents:function(){this._hammertime&&this._hammertime.enable(NO)},_enableEvents:function(){this._hammertime&&this._hammertime.enable(YES)},isEnabled:function(){return this._hammertime.enabled},render:function(){return this._preRender(),this._render(),this._renderChildViews(),this._postRender(),this},_preRender:function(){return this._assignTemplate(),this._assignTemplateValues(),this._extendTemplate(),this.preRender(),this},_assignTemplate:function(a){return a=a||this.template,"undefined"!=typeof a&&null!==a?"function"==typeof a?this._template=a:c.isString(a)?this._template=c.tmpl(a):c.isObject(a)&&(this._template=c.tmpl(e.TemplateManager.get.apply(this,["template"]))):this._templateString&&(this._template=this._useStickit()?c.tmpl(this._templateString):c.tmpl(this._templateString,null,{useStickitAttribute:NO}),this.template=this._template),this},_assignTemplateValues:function(){this._templateValues={};var a=this._getValue();this.model?e.isModel(a)?this._templateValues=e.Object.deepCopy(this.model.attributes):this._templateValues._value=this.model.get(a.attribute):e.isI18NItem(a)?this._templateValues._value=e.I18N.l(a.key,a.placeholder):"string"==typeof a||"number"==typeof a?this._templateValues._value=a:null!==a&&"object"==typeof a&&this._hasI18NListener===NO?this._templateValues=e.Object.deepCopy(a):this._hasI18NListener&&c.each(a,function(a,b){this._templateValues[b]=e.I18N.l(a.key,a.placeholder)},this),"undefined"!=typeof this._templateValues._value&&"undefined"==typeof this._templateValues.value&&(this._templateValues.value=this._templateValues._value),c.extend(this._templateValues,this.assignTemplateValues())},assignTemplateValues:function(){return null},_extendTemplate:function(){if(this.extendTemplate){var a=c.template(this._templateString);this._templateValues.value=this.extendTemplate,this._template=c.tmpl(a(this._templateValues))}},preRender:function(){},_render:function(){var a=this._template(this._templateValues);return this.useElement?this.setElement(a):this._attachToDom()?this.$el.html(a):this.$el.html(""),this},_attachToDom:function(){return null!==this.getValue()},_renderChildViews:function(){return this.childViews?(c.each(this.childViews,function(a,b){var d=this._getChildViewRenderDom(b);"function"==typeof a.render?this._renderChildView(d,a):c.isArray(a)&&c.each(a,function(a){this._renderChildView(d,a)},this)},this),this):void 0},_getChildViewRenderDom:function(a){var b=this.$el;return this.$el.find('[data-childviews="'+a+'"]').length&&(b=this.$el.find('[data-childviews="'+a+'"]'),b.addClass(a)),b},_renderChildView:function(a,b){this._renderChildViewToDom(a,b),b.delegateEvents()},_renderChildViewToDom:function(a,b){this._appendToDom(a,b.render().$el)},_appendToDom:function(a,b){a.append(b)},_postRender:function(){return this.useElement&&this._registerEvents(),this._addClassNames(),this._useStickit()&&(this._assignBinding(),this.stickit()),this.model&&this.useElement,this.postRender(),this._firstRender=NO,this},_addClassNames:function(){var a=this._getViewCssClassName();this.$el.addClass(a),this.cssClass&&this.$el.addClass(this.cssClass),this._internalCssClasses&&this.$el.addClass(this._internalCssClasses),this.grid&&this.$el.addClass(this.grid)},_useStickit:function(){return this.model?YES:NO},_getViewCssClassName:function(){var a=null;return a=0===this._type.toString().indexOf("M.")?this._type.split("M.")[1].toLowerCase():this._type.toString(),a.indexOf(" ")>=0&&(console.warn("The View type contains whitespaces: "+this._type+". The _type property gets added to the css classes. Since there are whitespaces inside the name the view has multiple classes. To set a class overwrite _getViewCssClassName method of the view"),a=""),a.indexOf(".")>=0&&(console.warn("The View type contains dots: "+this._type+". The _type property gets added to the css classes. Since there are dots inside the name we skiped this. To enable this featuer overwrite the _getViewCssClassName method"),a=""),a},_assignBinding:function(){var a={},b=this._getValue(),d="";return this.model&&!e.isModel(b)?(d='[data-binding="value"]',a[d]={observe:""+b.attribute}):this.collection?(d='[data-binding="value"]',a[d]={observe:"value"}):this.model&&e.isModel(b)?c.each(this.model.attributes,function(b,c){var d='[data-binding="'+c+'"]';a[d]={observe:""+c}},this):null===this.extendTemplate&&this.scopeKey?(d='[data-binding="value"]',a[d]={observe:""+this.scopeKey}):c.each(this._templateValues,function(b,c){d='[data-binding="'+c+'"]',a[d]={observe:""+c}},this),c.each(a,function(b,c){"function"==typeof this.onGet&&(a[c].onGet=function(a){var b=this.onGet(a);return b}),"function"==typeof this.onSet&&(a[c].onSet=function(a){var b=this.onSet(a);return b})},this),this.bindings=a,this},postRender:function(){},updateTemplate:function(){var a=this.template||e.TemplateManager.get(this._type);return this._assignTemplate(a),this._updateChildViewsTemplate(),this},_updateChildViewsTemplate:function(){return this.childViews?(c.each(this.childViews,function(a){"function"==typeof a.updateTemplate?a.updateTemplate():c.isArray(a)&&c.each(a,function(a){a.updateTemplate()})},this),this):void 0},setChildView:function(a,b){this.childViews[a]?this.childViews[a]=b:this.addChildView(a,b)},getChildView:function(a){return this.childViews[a]?this.childViews[a]:null},addChildView:function(a,b){return c.isObject(a)?(c.each(a,function(a,b){this._mergeChildView(b,a)},this),this):this._mergeChildView(a,b)},_mergeChildView:function(a,b){if(!c.isString(a)||!e.isView(b))return void 0;var d=this.childViews[a];if(c.isArray(d))d.push(b);else if(c.isObject(d)){var f=[];f.push(d),f.push(b),this.childViews[a]=f,f=null}else this.childViews[a]=b;return this},_unbindEvent:function(a){this._hammertime.off(a,this._eventCallback[a])},_getChildView:function(a){var b=parseInt(a,10);c.isNaN(b)||(a=b);var d=c.isNumber(a)?Object.keys(this.childViews)[a]:a;return this.childViews[d]},_getInternationalizedTemplateValue:function(a){return e.isI18NItem(a)?e.I18N.l(a.key,a.placeholder):a?a:""},_getsVisible:function(){this._childViewsGetsVisible(),this.getsVisible()},getsVisible:function(){},_childViewsGetsVisible:function(){c.each(this.childViews,function(a){a._getsVisible()},this)},getParent:function(){return this._parentView}}),e.View.extend=function(a,c){return a=a||{},c&&(a._childViews=c),a.childViews&&(a._childViews=a.childViews),b.View.extend.apply(this,[a])},e.View.create=function(a,b,d){var f=d||e.isController(a)?{scope:a}:a,g=new this(f);return g.childViews={},g._childViews&&c.each(g._childViews,function(b,c){var d=a;g.useAsScope===YES&&(d=g),g.childViews[c]=b.create(d||g,null,!0),g.childViews[c]._parentView=g}),b&&(g.childViews=g.childViews||{},c.each(b,function(a,b){g.childViews[b]=a,g.childViews[b]._parentView=g})),g._setChildViewValue(g._getValue()),g}}(this),e.Layout=e.View.extend({_type:"M.Layout",isMLayout:YES,template:"<div></div>",childViews:{},applyViews:function(){this._getsVisible()},_attachToDom:function(){return YES},setTransition:function(a){e.PageTransitions.setTransition(a)},startTransition:function(){e.PageTransitions.startTransition(),this._getsVisible()},isAnimating:function(){return e.PageTransitions.isAnimating()},destroy:function(){this.$el.remove(),this.$el=null,this.childViews=null,e.PageTransitions.reset()}}),e.Themes=e.Object.design({DEFAULT_THEME:"basic",basic:{},_currentThemeName:"basic",_themes:{},registerTemplateForTheme:function(a,b,c,d){d=d||!1;var e=this._getThemeByName(a);e||this._createThemeWithName(a);var f=""!==this._getTemplateByNameForTheme(a,b);
return!f||d?(this._themes[a][b]=c,!0):(console.warn('Template "'+b+'" already defined for theme "'+a+'"'),!1)},getTemplateByName:function(a){var b=this.getTemplateByNameForTheme(this._currentThemeName,a);return""===b&&this._currentThemeName!==this.DEFAULT_THEME&&(console.log('Template "'+a+'" not defined for theme "'+this._currentThemeName+'", switched to default theme "'+this.DEFAULT_THEME+'"'),b=this.getTemplateByNameForTheme(this.DEFAULT_THEME,a)),b},getTemplateByNameForTheme:function(a,b){var c=this._getTemplateByNameForTheme(a,b);return c?c:(console.warn('Template "'+b+'" not defined for theme "'+a+'"'),"")},_getTemplateByNameForTheme:function(a,b){var c=this._getThemeByName(a);return c&&c[b]?c[b]:""},_createThemeWithName:function(a){this._themes[a]={}},_getThemeByName:function(a){return this._themes[a]?this._themes[a]:null}}),e.TextfieldView=e.View.extend({_type:"M.TextfieldView",label:null,type:"search",placeholder:null,icon:null,_template:null,_templateString:e.TemplateManager.get("textfield.ejs"),_useCustomClear:NO,useCustomClear:NO,initialize:function(a){return("clear"===this.type||"clear"===a.type||this.useCustomClear)&&(this.type=this.type||"text",this._useCustomClear=YES),e.View.prototype.initialize.apply(this,arguments),this._useCustomClear&&this._addClearButton(),this},_addClearButton:function(){var a=this._getValue();if(!e.isModel(a)){var b=a;b||(b=""),a=e.Model.create({value:b})}this._setModel(a),this._setValue(a);var c=this;return this.icon=this.icon||"fa-times-circle",this.cssClass=this.cssClass||"right",""===this.getValue().value&&(this.cssClass+=" hidden-icon"),this.onSet=function(a){return a?c.$el.removeClass("hidden-icon"):c.$el.addClass("hidden-icon"),a},this},_assignTemplateValues:function(){return e.View.prototype._assignTemplateValues.apply(this),this._addLabelToTemplateValues(),this._addTypeToTemplateValues(),this._addPlaceholderToTemplateValues(),this._addIconToTemplateValues(),this},_addLabelToTemplateValues:function(){return this._templateValues.label=this._getInternationalizedTemplateValue(this.label),this},_addPlaceholderToTemplateValues:function(){return this._templateValues.placeholder=this._getInternationalizedTemplateValue(this.placeholder),this},_addTypeToTemplateValues:function(){return this._templateValues.type=this.type,this},_addIconToTemplateValues:function(){this._templateValues.icon=this.icon||""},_attachToDom:function(){return YES},_postRender:function(){if(e.View.prototype._postRender.apply(this,arguments),this._useCustomClear){var a=this;this.$el.find("i").on("click",function(){a.value.set("value",""),a.$el.addClass("hidden-icon")})}return this},_extendTemplate:function(){this.extendTemplate&&console.warn("Extend the Template of a M.TextFieldView is possible but be aware that the value attribute of the input is set with this string. Otherwise overwrite _templateString."),e.View.prototype._extendTemplate.apply(this,arguments)},getValue:function(){var a=e.View.prototype.getValue.apply(this,arguments);return a&&this.model||(a=this.$el.find("input").val()),a}}),e.SearchfieldView=e.TextfieldView.extend({_type:"M.SearchfieldView",placeholder:"Search",_templateString:e.TemplateManager.get("searchfield.ejs"),initialize:function(){e.View.prototype.initialize.apply(this)},_assignTemplateValues:function(){e.TextfieldView.prototype._assignTemplateValues.apply(this),this._templateValues.placeholder=this.placeholder||""}}),e.TextareaView=e.TextfieldView.extend({_type:"M.TextareaView",_templateString:e.TemplateManager.get("textarea.ejs"),_attachToDom:function(){return YES}}),e.ListItemView=e.View.extend({_type:"M.ListItemView",_templateString:e.TemplateManager.get("listitem.ejs"),type:"basic",icon:"fa-angle-right",initialize:function(){e.View.prototype.initialize.apply(this,arguments),this._applyBehaviour()},getIcon:function(){return this.model?this.model.get("icon"):this.icon},_applyBehaviour:function(){this.type===e.ListItemView.CONST.ICON&&(this.enabled=NO),(this.type===e.ListItemView.CONST.LINKED||this.type===e.ListItemView.CONST.ICON)&&(this.template=c.tmpl(e.TemplateManager.get("listitemlinked.ejs")))},_assignTemplateValues:function(){e.View.prototype._assignTemplateValues.apply(this,arguments),(this.type===e.ListItemView.CONST.LINKED||this.type===e.ListItemView.CONST.ICON)&&(this._templateValues.icon=this.getIcon())},_postRender:function(){e.View.prototype._postRender.apply(this,arguments),this.enabled===NO&&this.disable&&this.disable()},_renderChildViewToDom:function(a,b){this._appendToDom(a.find("li"),b.render().$el)}}).implements([e.ActiveState,e.ViewEnableState]),e.ListItemView.CONST={LINKED:1,BASIC:2,ICON:3},e.ButtonView=e.View.extend({_type:"M.ButtonView",_templateString:e.TemplateManager.get("button.ejs"),_isActive:YES,enabled:YES,initialize:function(){this.value=this.value||"",e.View.prototype.initialize.apply(this,arguments)},_assignTemplateValues:function(){e.View.prototype._assignTemplateValues.apply(this,arguments),this._templateValues.icon=this.icon?this.icon:""},_addClassNames:function(){e.View.prototype._addClassNames.apply(this,arguments);var a=this._getValue();""!==a&&this.icon&&""!==this.icon?this.$el.addClass("has-icon"):""===a&&this.icon&&""!==this.icon&&this.$el.addClass("is-icon-only")},isActive:function(){return this._isActive()},activate:function(){this._isAcitve=YES,this.$el.addClass("active")},deactivate:function(){this._isAcitve=NO,this.$el.removeClass("active")},_postRender:function(){e.View.prototype._postRender.apply(this,arguments),this.enabled===NO&&this.disable&&this.disable()}}).implements([e.ActiveState,e.ViewEnableState]),e.ListView=e.View.extend({_type:"M.ListView",_viewModelMapping:null,_template:null,_templateString:e.TemplateManager.get("list.ejs"),listItemView:null,_renderChildViews:function(){return this.useRenderUpdateFilter||(this._filterValue=!0),this.collection?this._renderItems(this.collection.filter(this.filterBy,this)):c.isArray(this.getValue())&&this._renderItems(this.getValue()),this},initialize:function(){return e.View.prototype.initialize.apply(this,arguments),this.collection&&this._applyListener(),this._viewModelMapping={},this},_applyListener:function(){return this.listenTo(this.collection,"add",function(a){this._renderEntry(a)}),this.listenTo(this.collection,"fetch",function(){}),this.listenTo(this.collection,"change",function(){}),this.listenTo(this.collection,"remove",function(a){var b=this._viewModelMapping[a.cid];b&&b.$el&&b.$el.remove()}),this.listenTo(this.collection,"sort",function(){this.render()}),this},_renderItems:function(a){return c.each(a,function(a,b){this._renderEntry(a,b)},this),this},_renderEntry:function(a,b){var c={header:this._getListItemHeader(a,b),item:this._getListItem(a,b),footer:this._getListItemFooter(a,b)};return c=this._renderListItemRow(c),this._cacheListItemRow(c,a.cid),this},_renderListItemRow:function(a){var b={};return c.each(a,function(a,c){b[c]=this._renderItem(a)},this),b},_cacheListItemRow:function(a,b){this._viewModelMapping[b]=a},_renderItem:function(a){return a?(e.View.prototype.isPrototypeOf(a.prototype)&&c.isFunction(a)&&(a=a.create()),a.render(),this.$el.find('[data-childviews="list"]').append(a.$el),a.delegateEvents(),a):void 0},_getListItem:function(a,b){return c.isFunction(this.getListItem)?this.getListItem(a,b).create({scope:this.scope,value:a}):this.listItemView?this.listItemView.create({scope:this.scope,value:a}):e.ListItemView.create({scope:this.scope,value:a,enable:NO})},getListItem:null,_getListItemHeader:function(a,b){return c.isFunction(this.getListItemHeader)?this.getListItemHeader(a,b):this.getListItemHeader},getListItemHeader:null,_getListItemFooter:function(a,b){return c.isFunction(this.getListItemFooter)?this.getListItemFooter(a,b):this.getListItemFooter},getListItemFooter:null,useRenderUpdateFilter:NO,filterBy:function(){return this.getFilterValue()},_renderUpdateFilter:function(){return this.$el.find('[data-childviews="list"]').empty(),this._renderChildViews(),this},_showHideFilter:function(){this.$el.find('[data-childviews="list"] .listitemview').hide();var a=this.collection.filter(this.filterBy,this);c.each(a,function(a,b){if(this.listItemView)this._showFilterElement(a.cid);else{var d=this._viewModelMapping[a.cid];c.isFunction(this.getListItemHeader)&&(this.getListItemHeader(a,b,d.header),this._showFilterElement(a.cid,"header")),c.isFunction(this.getListItem)&&(this.getListItem(a,b,d.item),this._showFilterElement(a.cid,"item")),c.isFunction(this.getListItemFooter)&&(this.getListItemFooter(a,b,d.footer),this._showFilterElement(a.cid,"footer"))}},this)},_showFilterElement:function(a,b){if(b){var c=this._viewModelMapping[a];c[b]&&c[b].$el&&c[b].$el.show()}else this._viewModelMapping[a].item.$el.show()},filter:function(a){return"undefined"!=typeof a&&this.setFilterValue(a),this.useRenderUpdateFilter?this._renderUpdateFilter():this._showHideFilter(),this},_filterValue:!0,setFilterValue:function(a){var b="undefined"==typeof a?YES:a;return this._filterValue=b,this},getFilterValue:function(){return this._filterValue}}),e.SliderView=e.View.extend({_type:"M.SliderView",_templateString:e.TemplateManager.get("slider.ejs"),_getEventOptions:function(){return{prevent_default:!1,no_mouseevents:!0}}}),e.DialogView=e.View.extend({_type:"M.DialogView",_templateString:e.TemplateManager.get("dialog.ejs")}),e.ToggleView=e.View.extend({_type:"M.ToggleView",_templateString:e.TemplateManager.get("toggle.ejs"),initialize:function(){e.View.prototype.initialize.apply(this,arguments)},render:function(a){return this._preRender(a),this._render(a),this._renderChildViews(a),this._postRender(a),this}}),e.ImageView=e.View.extend({_type:"M.ImageView",_templateString:e.TemplateManager.get("image.ejs"),alt:null,initialize:function(){return e.View.prototype.initialize.apply(this,arguments),this.alt=this.alt||"",this},_assignTemplateValues:function(){e.View.prototype._assignTemplateValues.apply(this,arguments);var a=this._getValue();return this.model?e.isModel(a)||(this._templateValues.alt=this.model.get(this.alt.attribute)):(a||"string"==typeof a)&&(this._templateValues.alt=this.alt),this}}),e.Toast=e.View.extend({_type:"M.ToastView",_templateString:e.TemplateManager.get("toast.ejs"),id:null,initialize:function(a){var b=this;b.id=c.uniqueId(),b.text=a.text||e.Toast.CONST.TEXT,d("body").append(b.render().$el),b.timeoutId=setTimeout(function(){b.remove()},a.timeout||e.Toast.CONST.MEDIUM)},_assignTemplateValues:function(){this._templateValues={id:this.id,text:this.text}},remove:function(){e.View.prototype.remove.apply(this,arguments),this.timeoutId&&clearTimeout(this.timeoutId),e.Toast._run()},_attachToDom:function(){return YES}}),e.Toast._stack=[],e.Toast._isSequencing=!1,e.Toast._currentToast=null,e.Toast.show=function(a,b){"string"==typeof a&&(a={text:a,timeout:b}),this._stack.push(a),this._isSequencing||(this._isSequencing=!0,this._run())},e.Toast.removeAll=function(){this._stack=[],this._currentToast&&(this._currentToast.remove(),this._currentToast=null)},e.Toast._run=function(){if(0===this._stack.length)return this._isSequencing=!1,void 0;var a=this._stack.shift();this._currentToast=e.Toast.create(a)},e.Toast.CONST={RAW:500,MEDIUM:2e3,CRISPY:4e3,TEXT:""},e.ToolbarView=e.View.extend({_type:"M.ToolbarView",_templateString:e.TemplateManager.get("toolbar.ejs")}),e.SelectView=e.View.extend({_type:"M.SelectView",isMultiple:NO,_templateString:e.TemplateManager.get("select.ejs"),_assignBinding:function(){return e.View.prototype._assignBinding.apply(this,arguments),this.selectOptions&&c.each(this.bindings,function(a){a.selectOptions=this.selectOptions},this),this},_assignTemplateValues:function(){e.View.prototype._assignTemplateValues.apply(this),this._templateValues.isMultiple=this.isMultiple}}),e.ButtonGroupView=e.View.extend({_type:"M.ButtonGroupView",_templateString:e.TemplateManager.get("buttongroup.ejs"),_internalCssClasses:"clearfix",setActive:function(a){var b=e.isView(a)?a:this._getChildView(a);c.each(this.childViews,function(a){a.deactivate()},this),b.activate()},getActive:function(){return c.find(this._childViews,function(a){return a.isActive()},this)},initialize:function(){e.View.prototype.initialize.apply(this,arguments);var a=this;this._childViews&&c.each(this._childViews,function(b,c){this._childViews[c]=b.extend({_isInButtonGroup:YES,_internalEvents:{touchstart:[function(b,c){a.setActive(c)}],mousedown:[function(b,c){a.setActive(c)}]}})},this)},_preRender:function(){e.View.prototype._preRender.apply(this,arguments),c.each(this.childViews,function(a){a.selected&&this.setActive(a)},this)},_addClassNames:function(){e.View.prototype._addClassNames.apply(this,arguments)}}),e.TabbarButtonGroupView=e.ButtonGroupView.extend({_type:"M.TabbarButtonGroupView",initialize:function(){e.View.prototype.initialize.apply(this,arguments);var a=this;if(this._childViews){var b=e.CONST.GRID.COLUMNS/Object.keys(this._childViews).length;c.each(this._childViews,function(c,d){this._childViews[d]=c.extend({grid:"col-xs-"+b,_internalEvents:{tap:[function(b,c){a.setActive(c)}]}})},this)}}}),e.TabView=e.View.extend({_type:"M.TabView",cssClass:"m-page m-tab"}),e.SelectionlistView=e.View.extend({_type:"M.SelectionlistView",_template:null,_templateString:null,_optionTemplate:null,_optionsContainer:"",_render:function(){return e.View.prototype._render.apply(this,arguments),this._renderOptions(),this},_renderOptions:function(){if(this.selectOptions&&this.selectOptions.collection){var a="";c.each(this.selectOptions.collection,function(b){a+=this._optionTemplate({name:this.cid+"-option",value:b[this.selectOptions.valuePath||"value"],label:b[this.selectOptions.labelPath||"label"]})},this),this.$el.children("div").children('[data-childviews="'+this._optionsContainer+'-options"]').append(a)}return this}}).implements([e.ActiveState]),e.RadiolistView=e.SelectionlistView.extend({_type:"M.RadiolistView",_templateString:e.TemplateManager.get("radiolist.ejs"),_optionTemplate:c.tmpl(e.TemplateManager.get("radiooption.ejs")),_optionsContainer:"radio"}).implements([e.ActiveState]),e.CheckboxlistView=e.SelectionlistView.extend({_type:"M.CheckboxlistView",_templateString:e.TemplateManager.get("checkboxlist.ejs"),_optionTemplate:c.tmpl(e.TemplateManager.get("checkboxoption.ejs")),_optionsContainer:"checkbox"}),e.ModalView=e.View.extend({_type:"M.ModalView",cssClass:"modalview",hideOnOverlayClick:YES,_templateString:e.TemplateManager.get("modal.ejs"),_isShown:NO,_shownCounter:0,_$backdrop:null,_backdropWillAppear:NO,_internalEvents:{tap:function(a,b){b._closeHandler(a,b)}},show:function(){return this._shownCounter+=1,this._shownCounter>0&&(this._showBackdrop(),d("body").append(this.$el),this._isShown=YES),this},hide:function(a){return this._shownCounter-=1,(a===YES||this._shownCounter<=0)&&(this.$el.remove(),this._isShown=NO,this._shownCounter=0,this._hideBackdrop()),this},isShown:function(){return this._isShown},toggle:function(a){this.isShown(a)?this.hide(!0):this.show(a)},_attachToDom:function(){return YES},_showBackdrop:function(){var a=this;a._$backdrop||(a._$backdrop=d('<div class="modal-backdrop fade"><div>'),a._$backdrop.appendTo("body"),e.Animation.transitionSupport&&(a._backdropWillAppear=YES,a._$backdrop.on(e.Animation.transitionEndEventName,function(){a._backdropWillAppear=NO}),setTimeout(function(){a._$backdrop&&a._$backdrop.addClass("in")},0)))},_hideBackdrop:function(){var a=this,b=function(){a._$backdrop&&(a._$backdrop.remove(),a._$backdrop=null,a._backdropWillAppear=NO)};a._$backdrop&&(e.Animation.transitionSupport&&a._backdropWillAppear===NO?(a._$backdrop.on(e.Animation.transitionEndEventName,b),setTimeout(function(){a._$backdrop&&a._$backdrop.removeClass("in")},0)):b())},_closeHandler:function(a,b){this.hideOnOverlayClick&&a.target===b.el&&b.hide()}}),e.LoaderView=e.ModalView.extend({_type:"M.LoaderView",hideOnOverlayClick:NO,show:function(a){return a=a||"",e.ModalView.prototype.show.apply(this,arguments),this.$el.find(".m-loaderview-inner-message").html(a),this}},{content:e.View.extend({_templateString:e.TemplateManager.get("loader.ejs"),_attachToDom:function(){return YES}})}),e.Loader=e.LoaderView.create().render(),e.TextView=e.View.extend({_type:"M.TextView",label:null,icon:null,_templateString:e.TemplateManager.get("text.ejs"),_assignTemplateValues:function(){return e.View.prototype._assignTemplateValues.apply(this),this._addLabelToTemplateValues(),this._addIconToTemplateValues(),this},_addLabelToTemplateValues:function(){return this._templateValues.label=this._getInternationalizedTemplateValue(this.label),this},_addIconToTemplateValues:function(){this._templateValues.icon=this.icon||""},_attachToDom:function(){return YES}}),e.DebugView=e.View.extend({_type:"M.DebugView",_templateString:e.TemplateManager.get("debug.ejs"),_debugViewIsHidden:YES,cssClass:"bg",useAsScope:YES,initialize:function(){e.View.prototype.initialize.apply(this,arguments),this._addShakeEvent()},hide:function(){this._debugViewIsHidden=YES,this.$el.hide()},show:function(){this._firstRender&&d("body").append(this.render().$el),this._debugViewIsHidden=NO,this.$el.show()},toggle:function(){this._debugViewIsHidden?this.show():this.hide()},toggleGrid:function(){this.$el.toggleClass("bg"),this.childViews["debug-grid"].$el.toggle()},androidLightTheme:function(){this.resetTheme(),d("html").addClass("android-light")},iosTheme:function(){this.resetTheme(),d("html").addClass("ios")},resetTheme:function(){d("html").removeClass("android").removeClass("android-light").removeClass("android-dark").removeClass("ios")},_addShakeEvent:function(){var a=this;window.addEventListener("shake",function(){a.toggle()},!1)}},{"debug-menu":e.ButtonGroupView.extend({cssClass:"debug-menu"},{toggleGrid:e.ButtonView.extend({value:"Toggle grid",events:{tap:"toggleGrid"}}),androidLight:e.ButtonView.extend({value:"android-light theme",events:{tap:"androidLightTheme"}}),ios:e.ButtonView.extend({value:"ios theme",events:{tap:"iosTheme"}}),reset:e.ButtonView.extend({value:"reset theme",events:{tap:"resetTheme"}})}),"debug-grid":e.View.extend({useElement:YES,template:function(){for(var a='<div class="debug-container"><div class="debug-grid col-xs-12"><div class="row">',b=0;12>b;b++)a+='<div class="col-xs-1"><div class="inner"></div></div>';return a+="</div></div></div>"}()})}),e.MovableView=e.View.extend({_type:"M.MovableView",_templateString:e.TemplateManager.get("movable.ejs"),leftEdge:0,duration:1e3,rightEdge:null,_rightEdge:null,_lastPos:{x:0,y:0,deltaX:0,deltaY:0,direction:""},_currentPos:{x:0,y:0,deltaX:0,deltaY:0,direction:""},_movableWidth:null,_containerWidth:null,_$movableContent:null,_isAnimating:NO,initialize:function(){e.View.prototype.initialize.apply(this,arguments),this.leftEdge=this.leftEdge||0},_postRender:function(){e.View.prototype._postRender.apply(this,arguments),this._$movableContent=this._getMovableContent()},_getsVisible:function(){e.View.prototype._getsVisible.apply(this,arguments),this.toLeft(),this.setDimensions()},_internalEvents:{dragright:function(a,b){b._drag(a,b)},dragleft:function(a,b){b._drag(a,b)},touchend:function(a,b){b._touchEnd(a,b)},mouseup:function(a,b){b._touchEnd(a,b)}},_drag:function(a){var b={};b.x=this._lastPos.x+a.gesture.deltaX,b.deltaX=a.gesture.deltaX,b.direction=this._currentPos.deltaX>a.gesture.deltaX?Hammer.DIRECTION_LEFT:Hammer.DIRECTION_RIGHT,this._move(b)},_touchEnd:function(a){(a.target===this._$movableContent[0]||this.$el.hasClass("on-move"))&&(this._currentPos.x<this.leftEdge?this._currentPos.x=this.leftEdge:this._containerWidth<this._currentPos.x+this._movableWidth&&(this._currentPos.x=this._containerWidth-this._movableWidth),this._lastPos=this._currentPos,this.onRelease())},onRelease:function(){this._currentPos.direction===Hammer.DIRECTION_LEFT?this.toLeft():this.toRight()},_getEventOptions:function(){return{prevent_default:!0,no_mouseevents:!0,stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none"}}},setDimensions:function(){this._movableWidth=this._$movableContent.outerWidth(),this._containerWidth=this.$el.outerWidth(),this._rightEdge=this.rightEdge||this._containerWidth-this._movableWidth},_getMovableContent:function(){return this.$el.find(".movable-element")},_move:function(a){var b=parseInt(a.x,10);b>this._rightEdge||b<this.leftEdge||(this._removeCssClasses(),this.$el.addClass("on-move"),this._setCss(a),a&&(this._currentPos=a))},toLeft:function(){this.$el.removeClass("on-right"),this.$el.addClass("on-left"),this._resetInlineCss(),this._lastPos.x=this.leftEdge,this._setCss({x:this._lastPos.x})},toRight:function(){this.$el.addClass("on-right"),this.$el.removeClass("on-left"),this.$el.removeClass("on-move"),this._resetInlineCss(),this._lastPos.x=this._rightEdge,this._setCss({x:this._lastPos.x})},toggle:function(){return this.$el.hasClass("on-left")?this.toRight():this.toLeft(),this},_setCss:function(a){if(a&&a.x&&"undefined"!=typeof a.x){var b=parseInt(a.x,10);if(!isNaN(b))return this._$movableContent.css("-webkit-transform","translate3d("+b+"px, 0, 0)"),this._$movableContent.css("-moz-transform","translate3d("+b+"px, 0, 0)"),this._$movableContent.css("transform","translate3d("+b+"px, 0, 0)"),this}return void 0},_removeCssClasses:function(){this.$el.removeClass("to-left"),this.$el.removeClass("to-right"),this.$el.removeClass("on-move")},_resetInlineCss:function(){this._$movableContent.attr("style","")},_attachToDom:function(){return YES}}),e.ToggleSwitchView=e.MovableView.extend({_type:"M.ToggleSwitchView",_templateString:e.TemplateManager.get("toggleswitch.ejs"),onValue:YES,offValue:NO,onLabel:e.TOGGLE_SWITCH_ON,offLabel:e.TOGGLE_SWITCH_OFF,rightEdge:35,selectOptions:null,_assignTemplateValues:function(){e.View.prototype._assignTemplateValues.apply(this,arguments),this._addLabelToTemplateValues(),this._addOnLabelToTemplateValues(),this._addOffLabelToTemplateValues()},initialize:function(){this._setSelectOptions();var a=this;this._internalEvents.tap=function(){a.toggle()},e.View.prototype.initialize.apply(this,arguments),null===this.getValue()&&this._setValue(this.offValue)},_setSelectOptions:function(){this.selectOptions={collection:[]}},onGet:function(a){return a===this.onValue||a===this.onLabel?(e.MovableView.prototype.toLeft.apply(this,arguments),this.onValue):(e.MovableView.prototype.toRight.apply(this,arguments),this.offValue)},onSet:function(){return this.$el.hasClass("on-left")?this.onValue:this.$el.hasClass("on-right")?this.offValue:void 0},toLeft:function(){e.MovableView.prototype.toLeft.apply(this,arguments),this._$valueContainer.trigger("change")},toRight:function(){e.MovableView.prototype.toRight.apply(this,arguments),this._$valueContainer.trigger("change")},_$valueContainer:null,_postRender:function(){e.MovableView.prototype._postRender.apply(this,arguments),this._$valueContainer=this.$el.find('[contenteditable="true"]')},_addLabelToTemplateValues:function(){this._templateValues.label=this._getInternationalizedTemplateValue(this.label)},_addOnLabelToTemplateValues:function(){this._templateValues.onLabel=this.onLabel||e.TOGGLE_SWITCH_ON},_addOffLabelToTemplateValues:function(){this._templateValues.offLabel=this.offLabel||e.TOGGLE_SWITCH_OFF}}),e.ToggleSwitchView.CONST={TOGGLE_SWITCH_ON:1,TOGGLE_SWITCH_OFF:2},e.MenuView=e.MovableView.extend({_type:"M.MenuView",_templateString:e.TemplateManager.get("menu.ejs"),leftEdge:0,rightEdge:null,_$backdrop:null,_deviceSwipeListenerWidth:0,_transitionTimeout:null,_internalCssClasses:"on-left",initialize:function(){this._deviceSwipeListenerWidth=parseInt(e.ThemeVars.get("m-menu-view-device-swipe-listener-width"),10),this.leftEdge=this.leftEdge||0,this._rightEdge=this.rightEdge||parseInt(e.ThemeVars.get("m-menu-view-width"),10)-this._deviceSwipeListenerWidth,e.MovableView.prototype.initialize.apply(this,arguments)},setDimensions:function(){e.MovableView.prototype.setDimensions.apply(this,arguments),this._rightEdge=this.rightEdge||parseInt(e.ThemeVars.get("m-menu-view-width"),10)-this._deviceSwipeListenerWidth},_postRender:function(){this._$backdrop=this.$el.find(".movable-backdrop"),e.MovableView.prototype._postRender.apply(this,arguments)},toLeft:function(){this.$el.removeClass("on-right"),this.$el.addClass("on-left"),this._resetInlineCss(),this._lastPos.x=0,this._$backdrop.removeClass("in"),this._$backdrop.css("opacity","0");var a=this;window.clearTimeout(this._transitionTimeout);var b=parseInt(e.ThemeVars.get("m-menu-transition"),10);this._transitionTimeout=setTimeout(function(){a.$el.removeClass("on-move")},b),this._onClose()},toRight:function(){e.MovableView.prototype.toRight.apply(this,arguments),this._$backdrop.addClass("in"),this._$backdrop.css("opacity","0.8"),this._onOpen()},_setCss:function(a){if(a&&a.x&&"undefined"!=typeof a.x){var b=parseInt(a.x,10);if(!isNaN(b))return this._setOpacity(this._getOpacityByPosition(a.x)),e.MovableView.prototype._setCss.apply(this,arguments)}return void 0},_getOpacityByPosition:function(a){var b=0===a?a:parseInt(10-this._rightEdge/a,10)/10;return 0>b&&(b=0),b>1&&(b=1),isNaN(b)?void 0:b},_setOpacity:function(a){this._$backdrop.css("opacity",a)},_getMovableContent:function(){return this.$el.find(".movable-container")},_drag:function(){e.MovableView.prototype._drag.apply(this,arguments),window.clearTimeout(this._transitionTimeout)},_onClose:function(){this.onClose()},_onOpen:function(){this.onOpen()},onClose:function(){},onOpen:function(){}}),e.Themes.registerTemplateForTheme(e.Themes.DEFAULT_THEME,"header-layout",'<div data-childviews="header" class="header"></div>'),e.HeaderLayout=e.Layout.extend({_type:"header-layout",template:e.Themes.getTemplateByName("header-layout"),applyViews:function(a){var b="header";return!this.childViews[b]&&a.header&&this.addChildView(b,a.header),a.header&&!this._firstRender&&(this.$el.find('[data-childviews="'+b+'"]').html(""),this.$el.find('[data-childviews="'+b+'"]').html(a.header.render().$el)),this}}),e.Themes.registerTemplateForTheme(e.Themes.DEFAULT_THEME,"bottom-bar-layout",'<div class="bottom-bar"></div>'),e.BottomBarLayout=e.Layout.extend({_type:"bottom-bar-layout",template:e.Themes.getTemplateByName("bottom-bar-layout")}),e.Themes.registerTemplateForTheme(e.Themes.DEFAULT_THEME,"switch-layout",'<div id="m-main" class="m-perspective"><div class="m-page m-page-1"><div data-childviews="content_page1" class="content-wrapper"></div></div><div class="m-page m-page-2"><div data-childviews="content_page2" class="content-wrapper"></div></div></div>'),e.SwitchLayout=e.Layout.extend({_type:"M.SwitchLayout",template:e.Themes.getTemplateByName("switch-layout"),_currentPage:null,applyViews:function(a){return null===this._currentPage||void 0===this._currentPage||"content_page2"===this._currentPage?this._currentPage="content_page1":"content_page1"===this._currentPage&&(this._currentPage="content_page2"),this.childViews[this._currentPage]?this.childViews[this._currentPage]!==a.content&&a.content&&this.setChildView(this._currentPage,a.content):a.content&&this.setChildView(this._currentPage,a.content),this._firstRender||(this.$el.find('[data-childviews="'+this._currentPage+'"]').html(""),this.$el.find('[data-childviews="'+this._currentPage+'"]').html(a.content.render().$el)),e.Layout.prototype.applyViews.apply(this,arguments),this},_postRender:function(){this._firstRender&&e.PageTransitions.init(this.$el.find("#m-main")),e.Layout.prototype._postRender.apply(this,arguments)}});var f=d('<div class="wrap"> <div class="left-panel firstLeft"> <div class="action-menu-close"></div> <div class="content"></div> </div> <div class="right-panel"> <div class="content"></div> </div> </div>');f.find(".right-panel").before(e.SwitchLayout.prototype.template),e.Themes.registerTemplateForTheme(e.Themes.DEFAULT_THEME,"swipe-layout",f),e.SwipeLayout=e.SwitchLayout.extend({_type:"M.SwipeLayout",template:e.Themes.getTemplateByName("swipe-layout"),leftPanelIsOpen:null,rightThreshold:null,initialize:function(){e.SwitchLayout.prototype.initialize.call(this);var a=d(window).width();this.rightThreshold=a/100*80},toggleRightPanel:function(){this.closeLeftPanel(),d(".right-panel").toggleClass("show")},closeRightPanel:function(){d(".right-panel").removeClass("show")},toggleLeftPanel:function(){this.closeRightPanel(),this.leftPanelIsOpen?this.closeLeftPanel():this.openLeftPanel()},startMoveLeftPanel:function(a){if(a&&a.originalEvent){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];this.moveStart=this.leftPanelIsOpen?0:b.pageX}},stopMoveLeftPanel:function(a){a.stopPropagation(),a.preventDefault(),d("#m-main").addClass("easing"),this.leftPanelIsOpen?this.closeLeftPanel():this.openLeftPanel(),setTimeout(function(){d("#m-main").removeClass("easing")},500)},moveLeftPanel:function(a){var b=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],c=b.pageX-this.moveStart;0>=c?c=0:c>=this.rightThreshold?c=this.rightThreshold:d("#m-main").css("-webkit-transform","translate3d("+c+"px, 0, 0)")},closeLeftPanel:function(){d("#m-main").css("-webkit-transform","translate3d(0px, 0, 0)"),this.leftPanelIsOpen=!1},openLeftPanel:function(){d("#m-main").css("-webkit-transform","translate3d("+this.rightThreshold+"px, 0, 0)"),this.leftPanelIsOpen=!0}}),e.TabLayout=e.Layout.extend({_tabMenu:null,_type:"M.TabLayout",scrolling:NO,smoothScrollAnimation:YES,template:'<div id="m-main" class="m-perspective"><div data-childviews="tab-menu"></div><div data-childviews="tab-content"></div></div>',switchToTabCallback:null,initialize:function(){this._tabMenu=e.TabbarButtonGroupView.extend({},{}).create(this,null,YES)},_render:function(){e.Layout.prototype._render.apply(this,arguments)},_postRender:function(){if(e.Layout.prototype._postRender.apply(this,arguments),this.$el.addClass(this.scrolling?"scrolling":""),this.$scrollContainer=this.$el.find("[data-childviews=tab-menu]"),this.scrolling){var a=parseInt(e.ThemeVars.get("tablayout-menu-scroll-button-width"),10)*Object.keys(this._tabMenu.childViews).length;this.$scrollContainer.children(".tabbarbuttongroupview").css("width",a+"px")}},switchToTab:function(a){0>a||a>=Object.keys(this._tabMenu.childViews).length||(this._scrollToTab(a),this._tabMenu.setActive(a),this.$el.find(".m-tab.m-page-current").removeClass("m-page-current"),this.childViews["tab-content"][a].$el.addClass("m-page-current"),this.switchToTabCallback&&"function"==typeof this.switchToTabCallback&&this.switchToTabCallback(a))},_scrollToTab:function(a){if(this.$scrollContainer){var b=parseInt(e.ThemeVars.get("tablayout-menu-scroll-button-width"),10),c=a*b-50;this.smoothScrollAnimation?this.$scrollContainer.stop().animate({scrollLeft:c},200):this.$scrollContainer.scrollLeft(c)}},applyViews:function(a){var b=[],c="col-xs-"+Math.floor(12/a.length);this.scrolling&&(c="");for(var d=0;d<a.length;d++){var e=this._createButton({index:d,grid:c,headline:a[d].headline,icon:a[d].icon});this._tabMenu.addChildView("button"+d,e),b.push(this._extendContent({index:d,content:a[d].content}))}this.addChildView("tab-menu",this._tabMenu),this.addChildView("tab-content",b)},_createButton:function(a){var b=this;return e.ButtonView.extend({value:a.headline,index:a.index,grid:a.grid,icon:a.icon,events:{tap:function(a,c){b.switchToTab(c.index)}}}).create()},_extendContent:function(a){var b=this;return a.content.extend({events:{dragleft:function(){b.switchToTab(a.index+1)},dragright:function(){b.switchToTab(a.index-1)}}}).create()},_mergeChildView:function(a,b){return this.childViews[a]=b,this}}),function(){var a=e.SwitchLayout.prototype.template,b=e.HeaderLayout.prototype.template,c=a.replace(/m-page-1">/gi,'m-page-1">'+b.replace(/data-childviews="header"/gi,'data-childviews="content_page1_header"'));c=c.replace(/m-page-2">/gi,'m-page-2">'+b.replace(/data-childviews="header"/gi,'data-childviews="content_page2_header"')),e.SwitchHeaderContentLayout=e.SwitchLayout.extend({_type:"M.SwitchHeaderContentLayout",template:c,cssClass:"switch-header-content-layout",applyViews:function(a){return e.SwitchLayout.prototype.applyViews.apply(this,[a]),!this.childViews[this._currentPage+"_header"]&&a.header&&this.setChildView(this._currentPage+"_header",a.header),a.header&&!this._firstRender&&(this.$el.find('[data-childviews="'+this._currentPage+'_header"]').html(""),this.$el.find('[data-childviews="'+this._currentPage+'_header"]').html(a.header.render().$el)),this
}})}(this),function(){var a=e.SwitchLayout.prototype.template,b=e.HeaderLayout.prototype.template,c=a.replace(/m-page-1">/gi,'m-page-1">'+b.replace(/data-childviews="header"/gi,'data-childviews="content_page1_header"'));c=c.replace(/m-page-2">/gi,'m-page-2">'+b.replace(/data-childviews="header"/gi,'data-childviews="content_page2_header"')),e.SwitchMenuHeaderContentLayout=e.SwitchHeaderContentLayout.extend({_type:"M.SwitchHeaderContentLayout",template:c,cssClass:"switch-menu-header-content-layout",menu:null,applyViews:function(a){this.menu||(a.menuContent&&e.MenuView.prototype.isPrototypeOf(a.menuContent)?(this.menu=a.menuContent,this.setChildView("menu",a.menuContent),this.menu.render(),this.$el.append(this.menu.$el)):(this.menu=e.MenuView.extend().create(),this.setChildView("menu",this.menu),this.menu.setChildView("menu-content",a.menuContent),this.menu.render(),this.$el.append(this.menu.$el)));return e.SwitchHeaderContentLayout.prototype.applyViews.apply(this,[a]),this}})}(this),function(){var a=e.SwitchLayout.prototype.template,b=e.HeaderLayout.prototype.template,c=a.replace(/m-page-1">/gi,'m-page-1">'+b.replace(/data-childviews="header"/gi,'data-childviews="content_page1_header"'));c=c.replace(/m-page-2">/gi,'m-page-2">'+b.replace(/data-childviews="header"/gi,'data-childviews="content_page2_header"')),e.SwitchHeaderContentLayout=e.SwitchLayout.extend({_type:"M.SwitchHeaderContentLayout",template:c,cssClass:"switch-header-content-layout",applyViews:function(a){return e.SwitchLayout.prototype.applyViews.apply(this,[a]),!this.childViews[this._currentPage+"_header"]&&a.header&&this.setChildView(this._currentPage+"_header",a.header),a.header&&!this._firstRender&&(this.$el.find('[data-childviews="'+this._currentPage+'_header"]').html(""),this.$el.find('[data-childviews="'+this._currentPage+'_header"]').html(a.header.render().$el)),this}})}(this),e.SplitLayout=e.SwitchLayout.extend({_type:"M.SplitLayout",gridLeft:"col-xs-4",gridRight:"col-xs-8",template:'<div id="m-main" class="m-perspective"><div id="leftContainer"><div class="m-page m-page-1"><div data-childviews="left_page1"></div></div><div class="m-page m-page-2"><div data-childviews="left_page2"></div></div></div><div id="rightContainer"><div class="m-page m-page-1"><div data-childviews="content_page1" class="content-wrapper"></div></div><div class="m-page m-page-2"><div data-childviews="content_page2" class="content-wrapper"></div></div></div></div>',_currentPage:null,initialize:function(){e.View.prototype.initialize.apply(this,arguments)},applyViews:function(a){var b=this._mapViews(this._currentContent,"content",a.content),c=this._mapViews(this._currentLeft,"left",a.left);return this._startTransition(a.left,a.content),this._currentContent=b,this._currentLeft=c,this},_startTransition:function(a,b){var c=this.getChildView(this._currentContent),d=this.getChildView(this._currentLeft);c&&c!==b&&this.rightTransition.startTransition(),d&&d!==a&&this.leftTransition.startTransition()},_mapViews:function(a,b,c){var d=b+"_page1",f=b+"_page2";return this.getChildView(a)!==c&&c?(null===a||void 0===a||a===f?a=d:a===d&&(a=f),c&&!this.childViews[a]?this.setChildView(a,c):c&&this.childViews[a]!==c&&this.setChildView(a,c),!this._firstRender&&c&&(this.$el.find('[data-childviews="'+a+'"]').html(""),this.$el.find('[data-childviews="'+a+'"]').html(c.render().$el)),e.Layout.prototype.applyViews.apply(this,arguments),a):(c||(this.$el.find('[data-childviews="'+d+'"]').html(""),this.$el.find('[data-childviews="'+f+'"]').html("")),a)},_postRender:function(){return this._getLeftContainer().addClass(this.gridLeft),this._getRightContainer().addClass(this.gridRight),this._firstRender&&(this.rightTransition=e.PageTransitions.design().init(this._getRightContainer()),this.leftTransition=e.PageTransitions.design().init(this._getLeftContainer()),setTimeout(c.bind(this._initRequire,this),0)),e.Layout.prototype._postRender.apply(this,arguments),this},_initRequire:function(){return"mobile"===Modernizr.Detectizr.device.type?(this._onPortrait(),void 0):(enquire.register("screen and (orientation: landscape)",{match:c.bind(this._onLandscape,this),unmatch:c.bind(this._onPortrait,this)}),window.innerWidth<window.innerHeight?this._onPortrait():this._onLandscape(),void 0)},_onLandscape:function(){this.$el.addClass("full").removeClass("single"),this._getLeftContainer().attr("class",""),this._getLeftContainer().addClass(this.gridLeft),this._getRightContainer().addClass(this.gridRight),this.onLandscape()},_onPortrait:function(){this.$el.addClass("single").removeClass("full"),this._getLeftContainer().attr("class",""),this.closeLeftContainer(),this._getRightContainer().addClass(this.gridRight).addClass("col-xs-12"),this.onPortrait()},onLandscape:function(){},onPortrait:function(){},_getLeftContainer:function(){return this.$el.find("#leftContainer")},_getRightContainer:function(){return this.$el.find("#rightContainer")},isAnimating:function(){return this.rightTransition.isAnimating()||this.leftTransition.isAnimating()},toggleLeftContainer:function(){this._getLeftContainer().toggleClass("close")},openLeftContainer:function(){this._getLeftContainer().removeClass("close")},closeLeftContainer:function(){this.$el.hasClass("single")&&this._getLeftContainer().addClass("close")}}),function(){"ios"===Modernizr.Detectizr.device.os&&document.addEventListener("DOMContentLoaded",function(){var a=document.createElement("div");a.id="ios7-matchMedia-fix",document.body.appendChild(a);var b,c=function(){a.style.width=window.innerWidth/2+"px"},d=function(){clearTimeout(b),b=setTimeout(c,100)};window.addEventListener("resize",d,!1)})}()}(this,Backbone,_,$);
//# sourceMappingURL=themproject.map